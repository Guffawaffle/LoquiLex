{
  // Tasks delegate to Makefile to prevent drift. Update commands only in Makefile.
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Bootstrap venv",
      "type": "shell",
      "command": "bash -lc 'test -x .venv/bin/python || (python3 -m venv .venv && source .venv/bin/activate && pip install -U pip && (pip install -e . || true) && (pip install -r requirements-dev.txt || true))'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },

    {
      "label": "Run Tests",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && make unit'",
      "options": { "cwd": "${workspaceFolder}" },
      "group": "test",
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },
    {
      "label": "Run E2E",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && make e2e'",
      "options": { "cwd": "${workspaceFolder}" },
      "group": "test",
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },

    {
      "label": "Coverage (HTML)",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && pytest --maxfail=1 --disable-warnings -q --cov=loquilex --cov-report=term-missing --cov-report=html:coverage_html'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },

    {
      "label": "Lint (ruff)",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && make lint'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },
    {
      "label": "Format (black)",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && make fmt'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },
    {
      "label": "Typecheck (mypy)",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && make typecheck'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },

    {
      "label": "Safety (vuln scan)",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && (safety check || pip install safety && safety check)'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },

    {
      "label": "Clean pyc/__pycache__",
      "type": "shell",
      "command": "bash -lc \"find . -type d -name '__pycache__' -prune -exec rm -rf {} + ; find . -name '*.py[cod]' -delete\"",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },

    {
      "label": "All Checks",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && make ci'",
      "options": { "cwd": "${workspaceFolder}" },
      "group": { "kind": "build", "isDefault": true },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },

    {
      "label": "Copilot: Promote (new → current)",
      "type": "shell",
      "command": ".github/copilot/rotate-task.sh promote",
      "problemMatcher": []
    },
    {
      "label": "Copilot: Advance (next → new)",
      "type": "shell",
      "command": ".github/copilot/rotate-task.sh advance",
      "problemMatcher": []
    },
    {
      "label": "Copilot: Complete (archive + clear current)",
      "type": "shell",
      "command": ".github/copilot/rotate-task.sh complete",
      "problemMatcher": []
    },

    // AUTO GENERATED BELOW THIS LINE - best of luck lol
    {
      "label": "Generate Docs",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && mkdocs build'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },
    {
      "label": "Serve Docs",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && mkdocs serve'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },
    {
      "label": "Publish Docs",
      "type": "shell",
      "command": "bash -lc 'source .venv/bin/activate && mkdocs gh-deploy --force'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": [],
      "dependsOn": ["Bootstrap venv"]
    },

    // Legacy CI helper tasks retained below
    {
      "label": "Docker CI (CI-identical container run)",
      "type": "shell",
      "command": "make docker-ci",
      "options": { "cwd": "${workspaceFolder}" },
      "group": "test",
      "problemMatcher": []
    },
    {
        "label": "Docker CI Test (GH parity)",
        "type": "shell",
        "command": "make docker-ci-test",
        "group": "test",
        "problemMatcher": []
    }
  ]
}
