## Executive Summary

Sync branch with main; run Docker CI parity.

## Steps Taken
Mon Sep 22 07:48:58 UTC 2025

### docker-ci-build output
`
=== Building CI-parity image ===
DOCKER_BUILDKIT=1 docker build -f Dockerfile.ci -t loquilex-ci . --progress=plain
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.ci
#1 transferring dockerfile: 838B done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/python:3.12-slim
#2 DONE 0.1s

#3 [internal] load .dockerignore
#3 transferring context: 328B done
#3 DONE 0.0s

#4 [internal] load build context
#4 ...

#5 [1/8] FROM docker.io/library/python:3.12-slim@sha256:abc799c7ee22b0d66f46c367643088a35e048bbabd81212d73c2323aed38c64f
#5 resolve docker.io/library/python:3.12-slim@sha256:abc799c7ee22b0d66f46c367643088a35e048bbabd81212d73c2323aed38c64f 0.0s done
#5 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 2.22MB 2.3s done
#4 DONE 2.3s

#6 [2/8] RUN apt-get update && apt-get install -y --no-install-recommends     git build-essential &&     rm -rf /var/lib/apt/lists/*
#6 CACHED

#7 [3/8] RUN python -m venv /opt/venv
#7 CACHED

#8 [4/8] WORKDIR /app
#8 CACHED

#9 [5/8] COPY requirements.txt requirements-ci.txt requirements-dev.txt ./
#9 CACHED

#10 [6/8] RUN if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
#10 CACHED

#11 [7/8] RUN pip install --upgrade pip &&     pip install ruff black mypy pytest
#11 CACHED

#12 [8/8] COPY . .
#12 DONE 9.3s

#13 exporting to image
#13 exporting layers
#13 exporting layers 12.6s done
#13 exporting manifest sha256:57c81fe9f66b19020ef20ea96d6bc28e63f576a25174b2b41f2409db048eaf6d done
#13 exporting config sha256:a2eacbe6d38a302f80fee4e35d8333b73075a4e1b5e582c555be7264789a3e64 done
#13 exporting attestation manifest sha256:47e8922e5da15233578f5eb8144528bacd936c11f16c4c96ecf33a83d9eb02c6 0.0s done
#13 exporting manifest list sha256:f44c9237be3a8cee6c6782c37d37766e18ad8300827391436c284a7ea5d92d7a done
#13 naming to docker.io/library/loquilex-ci:latest done
#13 unpacking to docker.io/library/loquilex-ci:latest
#13 unpacking to docker.io/library/loquilex-ci:latest 12.7s done
#13 DONE 25.3s
`

Mon Sep 22 07:49:36 UTC 2025

### docker-ci-run output
`
=== Running CI-parity test sequence in container ===
docker run --rm -v "/home/guff/LoquiLex":/app loquilex-ci ./scripts/ci-gh-parity.sh
=== Environment (offline flags) ===
TRANSFORMERS_OFFLINE=1
HF_HUB_DISABLE_TELEMETRY=1
LX_OFFLINE=1
HF_HUB_OFFLINE=1
=== Python ===
Python 3.12.11
pip 25.2 from /opt/venv/lib/python3.12/site-packages/pip (python 3.12)
=== Ruff ===
All checks passed!
=== Black --check ===
All done! ‚ú® üç∞ ‚ú®
99 files would be left unchanged.
=== MyPy (non-blocking, CI-style) ===
loquilex/cli/live_en_to_zh.py:424: note: By default the bodies of untyped functions are not checked, consider using --check-untyped-defs  [annotation-unchecked]
Success: no issues found in 50 source files
=== Pytest (unit/integration: not e2e) ===
============================= test session starts ==============================
platform linux -- Python 3.12.11, pytest-8.4.2, pluggy-1.6.0 -- /opt/venv/bin/python
cachedir: .pytest_cache
rootdir: /app
configfile: pytest.ini
testpaths: tests
plugins: timeout-2.4.0, mock-3.15.0, anyio-4.10.0, deadfixtures-2.2.1, asyncio-1.2.0, cov-7.0.0
timeout: 30.0s
timeout method: thread
timeout func_only: False
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 240 items / 10 deselected / 230 selected

tests/test_aggregator.py::test_aggregator_partial_debounce <- ../home/guff/LoquiLex/tests/test_aggregator.py PASSED [  0%]
tests/test_aggregator.py::test_aggregator_force_finalize <- ../home/guff/LoquiLex/tests/test_aggregator.py PASSED [  0%]
tests/test_api_minimal_http.py::test_create_and_stop_minimal_session_http <- ../home/guff/LoquiLex/tests/test_api_minimal_http.py PASSED [  1%]
tests/test_api_minimal_session.py::test_minimal_session_lifecycle <- ../home/guff/LoquiLex/tests/test_api_minimal_session.py PASSED [  1%]
tests/test_api_modules_import.py::test_import_api_modules_for_coverage <- ../home/guff/LoquiLex/tests/test_api_modules_import.py PASSED [  2%]
tests/test_asr_metrics.py::TestLatencyMetrics::test_empty_metrics <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  2%]
tests/test_asr_metrics.py::TestLatencyMetrics::test_single_measurement <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  3%]
tests/test_asr_metrics.py::TestLatencyMetrics::test_multiple_measurements <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  3%]
tests/test_asr_metrics.py::TestLatencyMetrics::test_bounded_recent_values <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  3%]
tests/test_asr_metrics.py::TestASRMetrics::test_basic_metrics <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  4%]
tests/test_asr_metrics.py::TestASRMetrics::test_asr_metrics_with_structured_logging <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  4%]
tests/test_asr_metrics.py::TestASRMetrics::test_initialization <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  5%]
tests/test_asr_metrics.py::TestASRMetrics::test_partial_event_tracking <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  5%]
tests/test_asr_metrics.py::TestASRMetrics::test_final_event_tracking <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  6%]
tests/test_asr_metrics.py::TestASRMetrics::test_eou_reason_counting <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  6%]
tests/test_asr_metrics.py::TestASRMetrics::test_summary_generation <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  6%]
tests/test_asr_metrics.py::TestASRMetrics::test_performance_targets <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  7%]
tests/test_asr_metrics.py::TestMetricsIntegration::test_aggregator_with_metrics <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  7%]
tests/test_asr_metrics.py::TestMetricsIntegration::test_aggregator_without_metrics <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  8%]
tests/test_asr_metrics.py::TestMetricsIntegration::test_metrics_in_stats <- ../home/guff/LoquiLex/tests/test_asr_metrics.py PASSED [  8%]
tests/test_bounded_queue.py::TestDropMetrics::test_initialization <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [  9%]
tests/test_bounded_queue.py::TestDropMetrics::test_record_drop <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [  9%]
tests/test_bounded_queue.py::TestDropMetrics::test_read_and_reset_recent <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 10%]
tests/test_bounded_queue.py::TestBoundedQueue::test_initialization <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 10%]
tests/test_bounded_queue.py::TestBoundedQueue::test_invalid_maxsize <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 10%]
tests/test_bounded_queue.py::TestBoundedQueue::test_put_get_basic <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 11%]
tests/test_bounded_queue.py::TestBoundedQueue::test_capacity_and_drop_oldest <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 11%]
tests/test_bounded_queue.py::TestBoundedQueue::test_peek <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 12%]
tests/test_bounded_queue.py::TestBoundedQueue::test_clear <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 12%]
tests/test_bounded_queue.py::TestBoundedQueue::test_drain <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 13%]
tests/test_bounded_queue.py::TestBoundedQueue::test_telemetry <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 13%]
tests/test_bounded_queue.py::TestBoundedQueue::test_thread_safety_structure <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 13%]
tests/test_bounded_queue.py::TestReplayBuffer::test_initialization <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 14%]
tests/test_bounded_queue.py::TestReplayBuffer::test_add_message_with_seq <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 14%]
tests/test_bounded_queue.py::TestReplayBuffer::test_get_messages_after <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 15%]
tests/test_bounded_queue.py::TestReplayBuffer::test_ttl_cleanup <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 15%]
tests/test_bounded_queue.py::TestReplayBuffer::test_ttl_disabled <- ../home/guff/LoquiLex/tests/test_bounded_queue.py PASSED [ 16%]
tests/test_cli_integration_offline.py::test_wav_to_vtt_offline_with_fake_asr <- ../home/guff/LoquiLex/tests/test_cli_integration_offline.py PASSED [ 16%]
tests/test_cli_integration_offline.py::test_vtt_to_zh_offline_with_fake_mt <- ../home/guff/LoquiLex/tests/test_cli_integration_offline.py PASSED [ 16%]
tests/test_cli_integration_offline.py::test_output_boundary_respected <- ../home/guff/LoquiLex/tests/test_cli_integration_offline.py PASSED [ 17%]
tests/test_cli_smoke.py::test_cli_runs_with_fake_capture_and_translator <- ../home/guff/LoquiLex/tests/test_cli_smoke.py PASSED [ 17%]
tests/test_compat_versions.py::test_starlette_httpx_compat <- ../home/guff/LoquiLex/tests/test_compat_versions.py PASSED [ 18%]
tests/test_config_env.py::test_env_overrides <- ../home/guff/LoquiLex/tests/test_config_env.py PASSED [ 18%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_seconds <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 19%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_milliseconds <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 19%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_minutes <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 20%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_hours <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 20%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_plain_number <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 20%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_invalid_value <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 21%]
tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_no_env_var <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 21%]
tests/test_config_parsing.py::TestConfigurationParsing::test_ws_protocol_config_with_time_suffixes <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 22%]
tests/test_config_parsing.py::TestConfigurationParsing::test_ws_protocol_config_defaults <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 22%]
tests/test_config_parsing.py::TestConfigurationParsing::test_complex_time_formats <- ../home/guff/LoquiLex/tests/test_config_parsing.py PASSED [ 23%]
tests/test_e2e_resume_flow.py::TestE2EResumeFlow::test_resume_flow_no_duplicate_finals <- ../home/guff/LoquiLex/tests/test_e2e_resume_flow.py PASSED [ 23%]
tests/test_e2e_resume_flow.py::TestE2EResumeFlow::test_ordering_guarantees_after_resume <- ../home/guff/LoquiLex/tests/test_e2e_resume_flow.py PASSED [ 23%]
tests/test_e2e_resume_flow.py::TestE2EResumeFlow::test_resume_with_expired_window <- ../home/guff/LoquiLex/tests/test_e2e_resume_flow.py PASSED [ 24%]
tests/test_live_outputs.py::test_partial_and_final_files <- ../home/guff/LoquiLex/tests/test_live_outputs.py PASSED [ 24%]
tests/test_live_outputs.py::test_append_vtt_and_srt <- ../home/guff/LoquiLex/tests/test_live_outputs.py PASSED [ 25%]
tests/test_mt_integration.py::test_mt_integration_disabled <- ../home/guff/LoquiLex/tests/test_mt_integration.py PASSED [ 25%]
tests/test_mt_integration.py::test_mt_integration_enabled <- ../home/guff/LoquiLex/tests/test_mt_integration.py SKIPPED [ 26%]
tests/test_mt_integration.py::test_mt_integration_translate_and_emit <- ../home/guff/LoquiLex/tests/test_mt_integration.py PASSED [ 26%]
tests/test_mt_integration.py::test_mt_integration_error_handling <- ../home/guff/LoquiLex/tests/test_mt_integration.py PASSED [ 26%]
tests/test_mt_integration.py::test_mt_integration_status <- ../home/guff/LoquiLex/tests/test_mt_integration.py PASSED [ 27%]
tests/test_mt_registry.py::test_registry_operations <- ../home/guff/LoquiLex/tests/test_mt_registry.py PASSED [ 27%]
tests/test_mt_registry.py::test_registry_unknown_provider <- ../home/guff/LoquiLex/tests/test_mt_registry.py PASSED [ 28%]
tests/test_mt_registry.py::test_mt_module_imports_without_heavy_deps <- ../home/guff/LoquiLex/tests/test_mt_registry.py PASSED [ 28%]
tests/test_mt_registry.py::test_ct2_provider_registration <- ../home/guff/LoquiLex/tests/test_mt_registry.py SKIPPED [ 29%]
tests/test_offline_env.py::test_offline_env_vars_set[HF_HUB_OFFLINE] <- ../home/guff/LoquiLex/tests/test_offline_env.py PASSED [ 29%]
tests/test_offline_env.py::test_offline_env_vars_set[TRANSFORMERS_OFFLINE] <- ../home/guff/LoquiLex/tests/test_offline_env.py PASSED [ 30%]
tests/test_offline_env.py::test_offline_env_vars_set[HF_HUB_DISABLE_TELEMETRY] <- ../home/guff/LoquiLex/tests/test_offline_env.py PASSED [ 30%]
tests/test_offline_env.py::test_offline_env_vars_set[LX_OFFLINE] <- ../home/guff/LoquiLex/tests/test_offline_env.py PASSED [ 30%]
tests/test_offline_isolation.py::test_offline_network_guard_blocks_external <- ../home/guff/LoquiLex/tests/test_offline_isolation.py PASSED [ 31%]
tests/test_offline_isolation.py::test_offline_network_guard_allows_localhost <- ../home/guff/LoquiLex/tests/test_offline_isolation.py PASSED [ 31%]
tests/test_offline_isolation.py::test_offline_env_vars_set <- ../home/guff/LoquiLex/tests/test_offline_isolation.py PASSED [ 32%]
tests/test_resilient_comms.py::TestResilientComms::test_session_resume_within_window <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 32%]
tests/test_resilient_comms.py::TestResilientComms::test_session_resume_expired <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 33%]
tests/test_resilient_comms.py::TestResilientComms::test_session_resume_wrong_session_id <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 33%]
tests/test_resilient_comms.py::TestResilientComms::test_session_resume_wrong_epoch <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 33%]
tests/test_resilient_comms.py::TestResilientComms::test_system_heartbeat_telemetry <- ../home/guff/LoquiLex/tests/test_resilient_comms.py SKIPPED [ 34%]
tests/test_resilient_comms.py::TestResilientComms::test_bounded_replay_buffer_integration <- ../home/guff/LoquiLex/tests/test_resilient_comms.py SKIPPED [ 34%]
tests/test_resilient_comms.py::TestResilientComms::test_telemetry_summary <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 35%]
tests/test_resilient_comms.py::TestResilientComms::test_queue_drop_notification <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 35%]
tests/test_resilient_comms.py::TestResilientComms::test_environment_configuration <- ../home/guff/LoquiLex/tests/test_resilient_comms.py PASSED [ 36%]
tests/test_resource_management.py::TestStreamingSessionResourceManagement::test_context_manager_cleanup <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 36%]
tests/test_resource_management.py::TestStreamingSessionResourceManagement::test_destructor_cleanup <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 36%]
tests/test_resource_management.py::TestSessionResourceManagement::test_context_manager_cleanup <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 37%]
tests/test_resource_management.py::TestSessionResourceManagement::test_destructor_handles_subprocess_cleanup <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 37%]
tests/test_resource_management.py::TestSessionManagerResourceManagement::test_shutdown_cleans_all_resources <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 38%]
tests/test_resource_management.py::TestSessionManagerResourceManagement::test_destructor_sets_stop_flag <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 38%]
tests/test_resource_management.py::TestBoundedQueueResourceManagement::test_cleanup_method_clears_resources <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 39%]
tests/test_resource_management.py::TestBoundedQueueResourceManagement::test_destructor_clears_queue <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 39%]
tests/test_resource_management.py::TestRollingTextFileResourceManagement::test_context_manager_support <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 40%]
tests/test_resource_management.py::TestResourceLeakDetection::test_memory_usage_bounded <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 40%]
tests/test_resource_management.py::TestResourceLeakDetection::test_thread_cleanup_after_operations <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 40%]
tests/test_resource_management.py::TestWSProtocolManagerResourceCleanup::test_context_manager_cleanup <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 41%]
tests/test_resource_management.py::TestWSProtocolManagerResourceCleanup::test_close_method_cleanup <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 41%]
tests/test_resource_management.py::TestAbruptShutdownScenarios::test_session_cleanup_during_exception <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 42%]
tests/test_resource_management.py::TestAbruptShutdownScenarios::test_manager_cleanup_with_active_sessions <- ../home/guff/LoquiLex/tests/test_resource_management.py PASSED [ 42%]
tests/test_safe_broadcast.py::test_safe_broadcast_no_loop_does_not_raise <- ../home/guff/LoquiLex/tests/test_safe_broadcast.py PASSED [ 43%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_storage_initialization <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 43%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_storage_with_env_config <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 43%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_add_session_commit <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 44%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_get_session_snapshot <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 44%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_get_session_storage_stats <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 45%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_with_sequence_tracking <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 45%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_storage_capping <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 46%]
tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_without_storage <- ../home/guff/LoquiLex/tests/test_session_state_integration.py PASSED [ 46%]
tests/test_session_storage.py::TestStorageConfig::test_default_values <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 46%]
tests/test_session_storage.py::TestStorageConfig::test_validation_success <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 47%]
tests/test_session_storage.py::TestStorageConfig::test_validation_negative_commits <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 47%]
tests/test_session_storage.py::TestStorageConfig::test_validation_negative_size <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 48%]
tests/test_session_storage.py::TestStorageConfig::test_validation_negative_age <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 48%]
tests/test_session_storage.py::TestSessionCommit::test_default_values <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 49%]
tests/test_session_storage.py::TestSessionCommit::test_custom_values <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 49%]
tests/test_session_storage.py::TestSessionCommit::test_size_calculation <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 50%]
tests/test_session_storage.py::TestSessionStorage::test_initialization <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 50%]
tests/test_session_storage.py::TestSessionStorage::test_initialization_with_config <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 50%]
tests/test_session_storage.py::TestSessionStorage::test_add_commit_basic <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 51%]
tests/test_session_storage.py::TestSessionStorage::test_add_multiple_commits <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 51%]
tests/test_session_storage.py::TestSessionStorage::test_get_commits_all <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 52%]
tests/test_session_storage.py::TestSessionStorage::test_get_commits_with_limit <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 52%]
tests/test_session_storage.py::TestSessionStorage::test_get_commits_by_type <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 53%]
tests/test_session_storage.py::TestSessionStorage::test_get_commits_since_timestamp <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 53%]
tests/test_session_storage.py::TestSessionStorage::test_count_based_capping <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 53%]
tests/test_session_storage.py::TestSessionStorage::test_time_based_capping <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 54%]
tests/test_session_storage.py::TestSessionStorage::test_size_based_capping <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 54%]
tests/test_session_storage.py::TestSessionStorage::test_get_snapshot <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 55%]
tests/test_session_storage.py::TestSessionStorage::test_get_snapshot_with_limit <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 55%]
tests/test_session_storage.py::TestSessionStorage::test_clear_storage <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 56%]
tests/test_session_storage.py::TestSessionStorage::test_thread_safety <- ../home/guff/LoquiLex/tests/test_session_storage.py PASSED [ 56%]
tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_snapshot_with_finalized_transcript <- ../home/guff/LoquiLex/tests/test_snapshot_rehydrate.py PASSED [ 56%]
tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_resume_metrics_tracking <- ../home/guff/LoquiLex/tests/test_snapshot_rehydrate.py PASSED [ 57%]
tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_resume_miss_tracking <- ../home/guff/LoquiLex/tests/test_snapshot_rehydrate.py PASSED [ 57%]
tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_monotonic_timing_in_envelopes <- ../home/guff/LoquiLex/tests/test_snapshot_rehydrate.py PASSED [ 58%]
tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_final_seq_range_in_snapshot <- ../home/guff/LoquiLex/tests/test_snapshot_rehydrate.py PASSED [ 58%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_partial_event_processing <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 59%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_final_event_processing <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 59%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_duplicate_final_prevention <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 60%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_partials_after_final_ignored <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 60%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_partial_backpressure <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 60%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_snapshot_generation <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 61%]
tests/test_streaming_asr.py::TestPartialFinalAggregator::test_stats_tracking <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 61%]
tests/test_streaming_asr.py::TestFakeStreamingASR::test_deterministic_behavior <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 62%]
tests/test_streaming_asr.py::TestFakeStreamingASR::test_snapshot_functionality <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 62%]
tests/test_streaming_asr.py::TestFakeStreamingASR::test_force_finalize <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 63%]
tests/test_streaming_asr.py::TestIntegration::test_streaming_asr_with_aggregator <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 63%]
tests/test_streaming_asr.py::TestAsyncBridge::test_async_bridge_with_event_loop <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 63%]
tests/test_streaming_asr.py::TestAsyncBridge::test_async_bridge_no_event_loop <- ../home/guff/LoquiLex/tests/test_streaming_asr.py PASSED [ 64%]
tests/test_streaming_integration.py::TestStreamingIntegration::test_create_streaming_session <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 64%]
tests/test_streaming_integration.py::TestStreamingIntegration::test_asr_snapshot_endpoint <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 65%]
tests/test_streaming_integration.py::TestStreamingIntegration::test_regular_session_no_asr_snapshot <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 65%]
tests/test_streaming_integration.py::TestStreamingIntegration::test_websocket_streaming_events[asyncio] <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 66%]
tests/test_streaming_integration.py::TestStreamingIntegration::test_websocket_streaming_events[trio] <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 66%]
tests/test_streaming_integration.py::TestStreamingConfiguration::test_streaming_config_validation <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 66%]
tests/test_streaming_integration.py::TestStreamingConfiguration::test_model_id_validation <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 67%]
tests/test_streaming_integration.py::TestStreamingConfiguration::test_device_selection <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 67%]
tests/test_streaming_integration.py::TestSnapshotStatus::test_streaming_session_status_running <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 68%]
tests/test_streaming_integration.py::TestSnapshotStatus::test_streaming_session_status_stopped <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 68%]
tests/test_streaming_integration.py::TestErrorHygiene::test_metrics_error_no_exception_leak <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 69%]
tests/test_streaming_integration.py::TestErrorHygiene::test_snapshot_error_no_exception_leak <- ../home/guff/LoquiLex/tests/test_streaming_integration.py PASSED [ 69%]
tests/test_structured_logging.py::TestDataRedactor::test_redact_file_paths <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 70%]
tests/test_structured_logging.py::TestDataRedactor::test_redact_sensitive_fields <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 70%]
tests/test_structured_logging.py::TestDataRedactor::test_nested_redaction <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 70%]
tests/test_structured_logging.py::TestStructuredLogger::test_basic_logging <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 71%]
tests/test_structured_logging.py::TestStructuredLogger::test_data_redaction <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 71%]
tests/test_structured_logging.py::TestStructuredLogger::test_create_logger_factory <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 72%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_latency_recording <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 72%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_throughput_recording <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 73%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_counters_and_gauges <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 73%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_timer_functionality <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 73%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_timer_error_handling <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 74%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_threshold_monitoring <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 74%]
tests/test_structured_logging.py::TestPerformanceMetrics::test_metrics_reset <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 75%]
tests/test_structured_logging.py::TestLogRetention::test_log_rotation_by_size <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 75%]
tests/test_structured_logging.py::TestLogRetention::test_log_rotation_keeps_max_files <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 76%]
tests/test_structured_logging.py::TestLogRetention::test_ci_logger_defaults <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 76%]
tests/test_structured_logging.py::TestLogRetention::test_cleanup_old_logs <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 76%]
tests/test_structured_logging.py::TestLogRetention::test_log_retention_env_vars <- ../home/guff/LoquiLex/tests/test_structured_logging.py PASSED [ 77%]
tests/test_text_io.py::test_rewrite_keeps_single_last_line <- ../home/guff/LoquiLex/tests/test_text_io.py PASSED [ 77%]
tests/test_text_io.py::test_append_enforces_max_lines <- ../home/guff/LoquiLex/tests/test_text_io.py PASSED [ 78%]
tests/test_text_io.py::test_utf8_and_trailing_newline <- ../home/guff/LoquiLex/tests/test_text_io.py PASSED [ 78%]
tests/test_text_io_concurrency.py::test_rolling_text_concurrent_appends_and_rewrites <- ../home/guff/LoquiLex/tests/test_text_io_concurrency.py PASSED [ 79%]
tests/test_timed_outputs.py::test_vtt_srt_append_order <- ../home/guff/LoquiLex/tests/test_timed_outputs.py PASSED [ 79%]
tests/test_units_extra.py::test_timestamp_formatting_helpers <- ../home/guff/LoquiLex/tests/test_units_extra.py PASSED [ 80%]
tests/test_units_extra.py::test_dtype_kwargs_version_switch <- ../home/guff/LoquiLex/tests/test_units_extra.py PASSED [ 80%]
tests/test_units_extra.py::test_pick_device_cpu <- ../home/guff/LoquiLex/tests/test_units_extra.py PASSED [ 80%]
tests/test_units_extra.py::test_post_processing <- ../home/guff/LoquiLex/tests/test_units_extra.py PASSED [ 81%]
tests/test_vtt_and_mt.py::test_vtt_monotonic <- ../home/guff/LoquiLex/tests/test_vtt_and_mt.py PASSED [ 81%]
tests/test_vtt_and_mt.py::test_translator_bos_handling <- ../home/guff/LoquiLex/tests/test_vtt_and_mt.py PASSED [ 82%]
tests/test_ws_integration.py::test_legacy_message_type_mapping <- ../home/guff/LoquiLex/tests/test_ws_integration.py PASSED [ 82%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_context_manager_cleanup <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 83%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_destructor_cancels_tasks <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 83%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_initialization <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 83%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_custom_configuration <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 84%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_add_connection_sends_welcome <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 84%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_remove_connection <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 85%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_client_hello_handling <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 85%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_client_ack_handling <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 86%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_domain_event_sending <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 86%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_flow_control_prevents_sending <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 86%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_resume_request_handling <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 87%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_resume_expired_error <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 87%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_heartbeat_sending <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 88%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_invalid_message_handling <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 88%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_unknown_message_type_handling <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 89%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_connection_failure_handling <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 89%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_session_cleanup_on_all_connections_failed <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 90%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_graceful_close <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 90%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_ack_spoof_protection <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 90%]
tests/test_ws_protocol.py::TestWSProtocolManager::test_resume_with_gaps <- ../home/guff/LoquiLex/tests/test_ws_protocol.py PASSED [ 91%]
tests/test_ws_types.py::TestWSEnvelope::test_minimal_envelope <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 91%]
tests/test_ws_types.py::TestWSEnvelope::test_full_envelope <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 92%]
tests/test_ws_types.py::TestWSEnvelope::test_auto_message_id_generation <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 92%]
tests/test_ws_types.py::TestWSEnvelope::test_no_auto_id_without_sid <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 93%]
tests/test_ws_types.py::TestWSEnvelope::test_json_serialization <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 93%]
tests/test_ws_types.py::TestDomainEventData::test_asr_partial_data <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 93%]
tests/test_ws_types.py::TestDomainEventData::test_asr_final_data <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 94%]
tests/test_ws_types.py::TestDomainEventData::test_mt_final_data <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 94%]
tests/test_ws_types.py::TestDomainEventData::test_status_data <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 95%]
tests/test_ws_types.py::TestControlMessages::test_client_hello <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 95%]
tests/test_ws_types.py::TestControlMessages::test_client_hello_with_resume <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 96%]
tests/test_ws_types.py::TestControlMessages::test_server_welcome <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 96%]
tests/test_ws_types.py::TestSessionState::test_session_initialization <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 96%]
tests/test_ws_types.py::TestSessionState::test_sequence_generation <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 97%]
tests/test_ws_types.py::TestSessionState::test_monotonic_time_calculation <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 97%]
tests/test_ws_types.py::TestSessionState::test_flow_control_limits <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 98%]
tests/test_ws_types.py::TestSessionState::test_replay_buffer_management <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 98%]
tests/test_ws_types.py::TestSessionState::test_replay_message_retrieval <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 99%]
tests/test_ws_types.py::TestSessionState::test_cumulative_ack_processing <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [ 99%]
tests/test_ws_types.py::TestSessionState::test_per_message_ack_processing <- ../home/guff/LoquiLex/tests/test_ws_types.py PASSED [100%]

==================================== PASSES ====================================
__________________ test_create_and_stop_minimal_session_http ___________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527382.416037,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_time":0.9298815727233887,"message":"Starting session","config":{"name":"session","asr_model_id":"fake-small","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=eba6ad59-e031-47b6-82cd-9e9365b0fcd3
{"timestamp":1758527382.418741,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"asr_metrics","session_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_time":0.00064849853515625,"message":"ASR metrics initialized","stream_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3"}
{"timestamp":1758527382.4209712,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.9348304271697998,"message":"Metric recorded: session_startup_eba6ad59-e031-47b6-82cd-9e9365b0fcd3","metric_type":"latency","metric_name":"session_startup_eba6ad59-e031-47b6-82cd-9e9365b0fcd3","metric_value":3.2978057861328125}
{"timestamp":1758527382.4219985,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.9358334541320801,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":1.0,"increment":1.0}
{"timestamp":1758527382.4232113,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.9370460510253906,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527382.424374,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_time":0.9382436275482178,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.2978057861328125,"total_sessions":1,"run_dir":"loquilex/out/eba6ad59-e031-47b6-82cd-9e9365b0fcd3"}
{"timestamp":1758527382.441887,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"asr_metrics","session_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_time":0.023730993270874023,"message":"ASR event: partial","event_type":"partial","stream_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_duration":0.02382681900053285,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg09655292"}{"timestamp":1758527382.4461184,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_time":0.9599428176879883,"message":"Stopping session"}

{"timestamp":1758527382.5477931,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":1.0616390705108643,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":1.0,"increment":1.0}
{"timestamp":1758527382.5487373,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":1.0625684261322021,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527382.549463,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"eba6ad59-e031-47b6-82cd-9e9365b0fcd3","session_time":1.0632851123809814,"message":"Session stopped successfully","total_sessions":0}
________________________ test_minimal_session_lifecycle ________________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527382.7074752,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"supervisor","session_time":0.000476837158203125,"message":"SessionManager initialized","max_cuda_sessions":1,"websocket_config":{"heartbeat_interval_ms":10000,"heartbeat_timeout_ms":30000,"max_in_flight":64,"max_msg_bytes":131072}}
{"timestamp":1758527382.7108796,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","session_time":0.003838062286376953,"message":"Starting session","config":{"name":"test","asr_model_id":"fake-small","mt_enabled":false,"dest_lang":"zh","device":"cpu","vad":false,"beams":1,"pause_flush_sec":0.2,"segment_max_sec":2.0,"partial_word_cap":10,"save_audio":"no","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=bd6cf5bd-9ebb-4a34-a25f-50d36a38a818
{"timestamp":1758527382.7129085,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"asr_metrics","session_id":"bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","session_time":0.0005886554718017578,"message":"ASR metrics initialized","stream_id":"bd6cf5bd-9ebb-4a34-a25f-50d36a38a818"}
{"timestamp":1758527382.714995,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.00796818733215332,"message":"Metric recorded: session_startup_bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","metric_type":"latency","metric_name":"session_startup_bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","metric_value":3.1321048736572266}
{"timestamp":1758527382.715681,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.008643627166748047,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":1.0,"increment":1.0}
{"timestamp":1758527382.7163756,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.009371757507324219,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527382.717146,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","session_time":0.010113716125488281,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.1321048736572266,"total_sessions":1,"run_dir":"loquilex/out/bd6cf5bd-9ebb-4a34-a25f-50d36a38a818"}
{"timestamp":1758527382.7178102,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","session_time":0.010771036148071289,"message":"Stopping session"}
{"timestamp":1758527382.915282,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.20832085609436035,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":1.0,"increment":1.0}
{"timestamp":1758527382.9161,"iso_timestamp":"2025-09-22T07:49:42Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.2090606689453125,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527382.9167275,"iso_timestamp":"2025-09-22T07:49:42Z","level":"info","component":"session_manager","session_id":"bd6cf5bd-9ebb-4a34-a25f-50d36a38a818","session_time":0.20969080924987793,"message":"Session stopped successfully","total_sessions":0}
______________________ TestASRMetrics.test_basic_metrics _______________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.1477299,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.00047898292541503906,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527383.1485646,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.001308441162109375,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.001174590001028264,"text_length":5,"word_count":0,"seq":null,"segment_id":"seg1"}
{"timestamp":1758527383.149485,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.002231597900390625,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":0.8655450001242571,"segment_id":"seg1","eou_reason":"silence"}
{"timestamp":1758527383.1503115,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0030596256256103516,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.002911895000579534,"text_length":11,"word_count":0,"eou_reason":"silence","segment_duration_ms":0.8655450001242571,"segment_id":"seg1"}
______________________ TestASRMetrics.test_initialization ______________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.2524297,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0006229877471923828,"message":"ASR metrics initialized","stream_id":"test_stream"}
__________________ TestASRMetrics.test_partial_event_tracking __________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.2957098,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004961490631103516,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":-1758526383.2953,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.05115743300120812,"text_length":5,"word_count":1,"seq":1,"segment_id":"seg1"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":-1758526383.2953,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":99.99999999854481,"segment_id":"seg1","text_length":11}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":-1758526383.2953,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.1511574330033909,"text_length":11,"word_count":1,"seq":2,"segment_id":"seg1"}
___________________ TestASRMetrics.test_final_event_tracking ___________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.3440359,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004532337188720703,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":-1758526383.3436704,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.051204546998633305,"text_length":5,"word_count":0,"seq":1,"segment_id":"seg1"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":-1758526383.3436704,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":99.99999999854481,"segment_id":"seg1","eou_reason":"punctuation"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":-1758526383.3436704,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.1512045470008161,"text_length":12,"word_count":1,"eou_reason":"punctuation","segment_duration_ms":99.99999999854481,"segment_id":"seg1"}
___________________ TestASRMetrics.test_eou_reason_counting ____________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.391126,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004456043243408203,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527383.392005,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0013184547424316406,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.0011344519989506807,"text_length":6,"word_count":0,"eou_reason":"punctuation","segment_duration_ms":null,"segment_id":"seg0"}
{"timestamp":1758527383.3929644,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0022783279418945312,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.002136907998647075,"text_length":6,"word_count":0,"eou_reason":"silence","segment_duration_ms":null,"segment_id":"seg1"}
{"timestamp":1758527383.3941615,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0034956932067871094,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.003229673999157967,"text_length":6,"word_count":0,"eou_reason":"timeout","segment_duration_ms":null,"segment_id":"seg2"}
{"timestamp":1758527383.3951478,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.004462480545043945,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.0042868079981417395,"text_length":6,"word_count":0,"eou_reason":"punctuation","segment_duration_ms":null,"segment_id":"seg3"}
____________________ TestASRMetrics.test_summary_generation ____________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.430783,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.00046133995056152344,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527383.431544,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0012364387512207031,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.0011136089997307863,"text_length":5,"word_count":0,"seq":1,"segment_id":"seg1"}
{"timestamp":1758527383.4325418,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.0022177696228027344,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":0.8723890023247804,"segment_id":"seg1","eou_reason":"punctuation"}
{"timestamp":1758527383.4334028,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0030794143676757812,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.0029076899991196115,"text_length":12,"word_count":0,"eou_reason":"punctuation","segment_duration_ms":0.8723890023247804,"segment_id":"seg1"}
___________________ TestASRMetrics.test_performance_targets ____________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.20000000000004547,"text_length":5,"word_count":0,"seq":1,"segment_id":"seg1"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.0,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":199.9999999999318,"segment_id":"seg1","text_length":11}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.39999999999997726,"text_length":11,"word_count":0,"seq":2,"segment_id":"seg1"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.0,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":200.00000000004547,"segment_id":"seg1","eou_reason":"punctuation"}
{"timestamp":1000.0,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.6000000000000227,"text_length":12,"word_count":0,"eou_reason":"punctuation","segment_duration_ms":399.99999999997726,"segment_id":"seg1"}
_____________ TestMetricsIntegration.test_aggregator_with_metrics ______________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.5239325,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004737377166748047,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527383.5249224,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.001474142074584961,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.0013489320008375216,"text_length":5,"word_count":1,"seq":1,"segment_id":"seg1"}
{"timestamp":1758527383.5261052,"iso_timestamp":"2025-09-22T07:49:43Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.002652883529663086,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":1.0252089996356517,"segment_id":"seg1","eou_reason":"punctuation"}
{"timestamp":1758527383.5271137,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0036695003509521484,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.003412160000152653,"text_length":12,"word_count":1,"eou_reason":"punctuation","segment_duration_ms":1.0252089996356517,"segment_id":"seg1"}
_________________ TestMetricsIntegration.test_metrics_in_stats _________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527383.5888505,"iso_timestamp":"2025-09-22T07:49:43Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0005166530609130859,"message":"ASR metrics initialized","stream_id":"test_stream"}
____________________ test_wav_to_vtt_offline_with_fake_asr _____________________
----------------------------- Captured stdout call -----------------------------
[asr] device=cpu model=small.en compute=int8_float32
[cli] wrote /tmp/pytest-of-root/pytest-0/test_wav_to_vtt_offline_with_f0/a.vtt (2 cues)
_____________________ test_vtt_to_zh_offline_with_fake_mt ______________________
----------------------------- Captured stdout call -----------------------------
[cli] wrote /tmp/pytest-of-root/pytest-0/test_vtt_to_zh_offline_with_fa0/zh.txt and /tmp/pytest-of-root/pytest-0/test_vtt_to_zh_offline_with_fa0/zh.srt (2 cues)
________________ test_cli_runs_with_fake_capture_and_translator ________________
----------------------------- Captured stdout call -----------------------------
EN ‚â´ Starting service
ZH* ‚â´ [zh-draft]Starting service
[asr] device=cpu dtype=float32 model=small.en compute=int8_float32
VU 0.0000 0.0000 0.0000
EN ‚â´ hello world
ZH* ‚â´ [zh-draft]hello world
[cli] Ready ‚Äî start speaking now (capturing mic)‚Ä¶ for 1s (timer starts now; Ctrl+C to stop early)
[cli] run complete
___ TestSessionManagerResourceManagement.test_shutdown_cleans_all_resources ____
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527390.3780057,"iso_timestamp":"2025-09-22T07:49:50Z","level":"info","component":"session_manager","session_id":"supervisor","session_time":0.0004630088806152344,"message":"SessionManager initialized","max_cuda_sessions":1,"websocket_config":{"heartbeat_interval_ms":10000,"heartbeat_timeout_ms":30000,"max_in_flight":64,"max_msg_bytes":131072}}
{"timestamp":1758527390.3924832,"iso_timestamp":"2025-09-22T07:49:50Z","level":"info","component":"session_manager","session_id":"test_session","session_time":0.014937400817871094,"message":"Stopping session"}
{"timestamp":1758527390.3991854,"iso_timestamp":"2025-09-22T07:49:50Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.0216519832611084,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":1.0,"increment":1.0}
{"timestamp":1758527390.4001024,"iso_timestamp":"2025-09-22T07:49:50Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.02254176139831543,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527390.4008584,"iso_timestamp":"2025-09-22T07:49:50Z","level":"info","component":"session_manager","session_id":"test_session","session_time":0.023300886154174805,"message":"Session stopped successfully","total_sessions":0}
_____ TestSessionManagerResourceManagement.test_destructor_sets_stop_flag ______
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527390.4836538,"iso_timestamp":"2025-09-22T07:49:50Z","level":"info","component":"session_manager","session_id":"supervisor","session_time":0.00038433074951171875,"message":"SessionManager initialized","max_cuda_sessions":1,"websocket_config":{"heartbeat_interval_ms":10000,"heartbeat_timeout_ms":30000,"max_in_flight":64,"max_msg_bytes":131072}}
____ TestAbruptShutdownScenarios.test_manager_cleanup_with_active_sessions _____
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527391.0671973,"iso_timestamp":"2025-09-22T07:49:51Z","level":"info","component":"session_manager","session_id":"supervisor","session_time":0.00044608116149902344,"message":"SessionManager initialized","max_cuda_sessions":1,"websocket_config":{"heartbeat_interval_ms":10000,"heartbeat_timeout_ms":30000,"max_in_flight":64,"max_msg_bytes":131072}}
{"timestamp":1758527391.0815656,"iso_timestamp":"2025-09-22T07:49:51Z","level":"info","component":"session_manager","session_id":"session1","session_time":0.0148162841796875,"message":"Stopping session"}
{"timestamp":1758527391.088135,"iso_timestamp":"2025-09-22T07:49:51Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.021376848220825195,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":1.0,"increment":1.0}
{"timestamp":1758527391.089025,"iso_timestamp":"2025-09-22T07:49:51Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.02225804328918457,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527391.089683,"iso_timestamp":"2025-09-22T07:49:51Z","level":"info","component":"session_manager","session_id":"session1","session_time":0.022920846939086914,"message":"Session stopped successfully","total_sessions":1}
{"timestamp":1758527391.0903635,"iso_timestamp":"2025-09-22T07:49:51Z","level":"info","component":"session_manager","session_id":"session2","session_time":0.02359628677368164,"message":"Stopping session"}
{"timestamp":1758527391.0967455,"iso_timestamp":"2025-09-22T07:49:51Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.029980897903442383,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":2.0,"increment":1.0}
{"timestamp":1758527391.0975773,"iso_timestamp":"2025-09-22T07:49:51Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":0.030811071395874023,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527391.0983572,"iso_timestamp":"2025-09-22T07:49:51Z","level":"info","component":"session_manager","session_id":"session2","session_time":0.03159594535827637,"message":"Session stopped successfully","total_sessions":0}
__________________ test_safe_broadcast_no_loop_does_not_raise __________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527391.183769,"iso_timestamp":"2025-09-22T07:49:51Z","level":"info","component":"session_manager","session_id":"supervisor","session_time":0.00045609474182128906,"message":"SessionManager initialized","max_cuda_sessions":1,"websocket_config":{"heartbeat_interval_ms":10000,"heartbeat_timeout_ms":30000,"max_in_flight":64,"max_msg_bytes":131072}}
___________ TestPartialFinalAggregator.test_partial_event_processing ___________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527392.7764525,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.00047469139099121094,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527392.777511,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0015454292297363281,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.001304195997363422,"text_length":5,"word_count":1,"seq":1,"segment_id":"seg1"}
____________ TestPartialFinalAggregator.test_final_event_processing ____________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527392.821198,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.00047969818115234375,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527392.8222334,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0015265941619873047,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.0013007060006202664,"text_length":12,"word_count":2,"eou_reason":"punctuation","segment_duration_ms":null,"segment_id":"seg1"}
__________ TestPartialFinalAggregator.test_duplicate_final_prevention __________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527392.8617084,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004699230194091797,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527392.862811,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.001554727554321289,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.001334852000582032,"text_length":12,"word_count":1,"eou_reason":"punctuation","segment_duration_ms":null,"segment_id":"seg1"}
_________ TestPartialFinalAggregator.test_partials_after_final_ignored _________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527392.903332,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004980564117431641,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527392.9043524,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0015187263488769531,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.0013497039981302805,"text_length":5,"word_count":1,"seq":1,"segment_id":"seg1"}
{"timestamp":1758527392.905668,"iso_timestamp":"2025-09-22T07:49:52Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.0028460025787353516,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":1.223851999384351,"segment_id":"seg1","eou_reason":"punctuation"}
{"timestamp":1758527392.9066553,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0038268566131591797,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.00364391000039177,"text_length":12,"word_count":1,"eou_reason":"punctuation","segment_duration_ms":1.223851999384351,"segment_id":"seg1"}
_____________ TestPartialFinalAggregator.test_partial_backpressure _____________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527392.9484444,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.00043320655822753906,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527392.949465,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0014662742614746094,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.0013196990003052633,"text_length":5,"word_count":1,"seq":1,"segment_id":"seg0"}
{"timestamp":1758527392.9506478,"iso_timestamp":"2025-09-22T07:49:52Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.002643585205078125,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":1.147447997936979,"segment_id":"seg1","text_length":5}
{"timestamp":1758527392.9515162,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0035142898559570312,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.003411477999179624,"text_length":5,"word_count":1,"seq":2,"segment_id":"seg1"}
{"timestamp":1758527392.952644,"iso_timestamp":"2025-09-22T07:49:52Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.004640817642211914,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":2.037459002167452,"segment_id":"seg2","text_length":5}
{"timestamp":1758527392.9535735,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.005572319030761719,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.005438954998680856,"text_length":5,"word_count":1,"seq":3,"segment_id":"seg2"}
_____________ TestPartialFinalAggregator.test_snapshot_generation ______________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527392.9943297,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.00045609474182128906,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527392.9954422,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0015819072723388672,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.0013162690011085942,"text_length":12,"word_count":1,"eou_reason":"silence","segment_duration_ms":null,"segment_id":"final_seg0"}
{"timestamp":1758527392.996653,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.002786397933959961,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.0025559030000295024,"text_length":12,"word_count":1,"eou_reason":"silence","segment_duration_ms":null,"segment_id":"final_seg1"}
{"timestamp":1758527392.9977584,"iso_timestamp":"2025-09-22T07:49:52Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0038924217224121094,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.0037337370013119653,"text_length":15,"word_count":1,"seq":3,"segment_id":"live_seg"}
________________ TestPartialFinalAggregator.test_stats_tracking ________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527393.0443976,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0004951953887939453,"message":"ASR metrics initialized","stream_id":"test_stream"}
{"timestamp":1758527393.0455184,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.0016281604766845703,"message":"ASR event: partial","event_type":"partial","stream_id":"test_stream","session_duration":0.0014567920006811619,"text_length":5,"word_count":1,"seq":1,"segment_id":"seg1"}
{"timestamp":1758527393.0467675,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"asr_metrics","session_id":"test_stream","session_time":0.0028696060180664062,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":1.1805960020865314,"segment_id":"seg2","eou_reason":"punctuation"}
{"timestamp":1758527393.0478206,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"test_stream","session_time":0.003931283950805664,"message":"ASR event: final","event_type":"final","stream_id":"test_stream","session_duration":0.003689945999212796,"text_length":6,"word_count":1,"eou_reason":"punctuation","segment_duration_ms":1.1805960020865314,"segment_id":"seg2"}
_______________ TestFakeStreamingASR.test_deterministic_behavior _______________
----------------------------- Captured stdout call -----------------------------
[FakeStreamingASR] Initialized: stream_id=test_stream
_______________ TestFakeStreamingASR.test_snapshot_functionality _______________
----------------------------- Captured stdout call -----------------------------
[FakeStreamingASR] Initialized: stream_id=test_stream
___________________ TestFakeStreamingASR.test_force_finalize ___________________
----------------------------- Captured stdout call -----------------------------
[FakeStreamingASR] Initialized: stream_id=test_stream
______________ TestIntegration.test_streaming_asr_with_aggregator ______________
----------------------------- Captured stdout call -----------------------------
[FakeStreamingASR] Initialized: stream_id=integration_test
{"timestamp":1758527393.2147965,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"integration_test","session_time":0.0005502700805664062,"message":"ASR metrics initialized","stream_id":"integration_test"}
{"timestamp":1758527393.2164145,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"integration_test","session_time":0.0021615028381347656,"message":"ASR event: partial","event_type":"partial","stream_id":"integration_test","session_duration":0.0018134019992430694,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg147321a8"}
{"timestamp":1758527393.2178268,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"asr_metrics","session_id":"integration_test","session_time":0.003545045852661133,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":1.4771030000702012,"segment_id":"seg147321a8","text_length":16}
{"timestamp":1758527393.2187583,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"integration_test","session_time":0.004473447799682617,"message":"ASR event: partial","event_type":"partial","stream_id":"integration_test","session_duration":0.004284111000742996,"text_length":16,"word_count":3,"seq":2,"segment_id":"seg147321a8"}
{"timestamp":1758527393.219924,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"asr_metrics","session_id":"integration_test","session_time":0.0056400299072265625,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":2.1738020004704595,"segment_id":"seg147321a8","text_length":19}
{"timestamp":1758527393.2208622,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"integration_test","session_time":0.006578207015991211,"message":"ASR event: partial","event_type":"partial","stream_id":"integration_test","session_duration":0.006378238002071157,"text_length":19,"word_count":4,"seq":3,"segment_id":"seg147321a8"}
{"timestamp":1758527393.2223506,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"asr_metrics","session_id":"integration_test","session_time":0.008072137832641602,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":2.2537959994224366,"segment_id":"seg147321a8","eou_reason":"punctuation"}
{"timestamp":1758527393.2236166,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"integration_test","session_time":0.009342670440673828,"message":"ASR event: final","event_type":"final","stream_id":"integration_test","session_duration":0.00899476500126184,"text_length":27,"word_count":6,"eou_reason":"punctuation","segment_duration_ms":5.904700999963097,"segment_id":"seg147321a8"}
____________ TestStreamingIntegration.test_create_streaming_session ____________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527393.36413,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_time":11.877975463867188,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=3f56040b-58e2-4769-86dd-cd3ef9ea5d49
{"timestamp":1758527393.3667452,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_time":0.0006122589111328125,"message":"ASR metrics initialized","stream_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49"}
{"timestamp":1758527393.3687615,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":11.882605791091919,"message":"Metric recorded: session_startup_3f56040b-58e2-4769-86dd-cd3ef9ea5d49","metric_type":"latency","metric_name":"session_startup_3f56040b-58e2-4769-86dd-cd3ef9ea5d49","metric_value":3.273487091064453}
{"timestamp":1758527393.3697264,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":11.883557319641113,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":2.0,"increment":1.0}
{"timestamp":1758527393.3706274,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":11.884461164474487,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527393.3715975,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_time":11.885427951812744,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.273487091064453,"total_sessions":1,"run_dir":"loquilex/out/3f56040b-58e2-4769-86dd-cd3ef9ea5d49"}
{"timestamp":1758527393.3770533,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_time":0.010852575302124023,"message":"ASR event: partial","event_type":"partial","stream_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_duration":0.010982174997479888,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg09a91f1a"}
{"timestamp":1758527393.392638,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_time":11.906458139419556,"message":"Stopping session"}
{"timestamp":1758527393.5784748,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.09229850769043,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":2.0,"increment":1.0}
{"timestamp":1758527393.5792975,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.093114137649536,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527393.5799465,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"3f56040b-58e2-4769-86dd-cd3ef9ea5d49","session_time":12.093764305114746,"message":"Session stopped successfully","total_sessions":0}
_____________ TestStreamingIntegration.test_asr_snapshot_endpoint ______________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527393.6482854,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":12.162120819091797,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=f33f55a3-18f0-4003-9d81-24ed2a00f24f
{"timestamp":1758527393.6508853,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":0.0006368160247802734,"message":"ASR metrics initialized","stream_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f"}
{"timestamp":1758527393.6527755,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.166605949401855,"message":"Metric recorded: session_startup_f33f55a3-18f0-4003-9d81-24ed2a00f24f","metric_type":"latency","metric_name":"session_startup_f33f55a3-18f0-4003-9d81-24ed2a00f24f","metric_value":3.1387805938720703}
{"timestamp":1758527393.6537018,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.167524576187134,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":3.0,"increment":1.0}
{"timestamp":1758527393.6546462,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.168474197387695,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527393.6556711,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":12.169496297836304,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.1387805938720703,"total_sessions":1,"run_dir":"loquilex/out/f33f55a3-18f0-4003-9d81-24ed2a00f24f"}
{"timestamp":1758527393.661609,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":0.011303424835205078,"message":"ASR event: partial","event_type":"partial","stream_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_duration":0.011388718001398956,"text_length":11,"word_count":2,"seq":1,"segment_id":"sege285ef4c"}
{"timestamp":1758527393.7628057,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"asr_metrics","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":0.11251950263977051,"message":"Metric recorded: partial_interval","metric_type":"latency","metric_name":"partial_interval","metric_value":101.10464700119337,"segment_id":"sege285ef4c","text_length":16}
{"timestamp":1758527393.7635036,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"asr_metrics","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":0.11319160461425781,"message":"ASR event: partial","event_type":"partial","stream_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_duration":0.11329315000330098,"text_length":16,"word_count":3,"seq":2,"segment_id":"sege285ef4c"}
{"timestamp":1758527393.7991116,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":12.312963247299194,"message":"Stopping session"}
{"timestamp":1758527393.9648888,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.47876501083374,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":3.0,"increment":1.0}
{"timestamp":1758527393.9659853,"iso_timestamp":"2025-09-22T07:49:53Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.479841709136963,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527393.9668353,"iso_timestamp":"2025-09-22T07:49:53Z","level":"info","component":"session_manager","session_id":"f33f55a3-18f0-4003-9d81-24ed2a00f24f","session_time":12.480677604675293,"message":"Session stopped successfully","total_sessions":0}
________ TestStreamingIntegration.test_regular_session_no_asr_snapshot _________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527394.050547,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"efb33b73-ad8e-46f5-973d-72d0f750e44f","session_time":12.564384460449219,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":false}}
{"timestamp":1758527394.0584455,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.572285413742065,"message":"Metric recorded: session_startup_efb33b73-ad8e-46f5-973d-72d0f750e44f","metric_type":"latency","metric_name":"session_startup_efb33b73-ad8e-46f5-973d-72d0f750e44f","metric_value":6.586551666259766}
{"timestamp":1758527394.0593607,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.573195934295654,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":4.0,"increment":1.0}
{"timestamp":1758527394.0602632,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.574089288711548,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527394.0614033,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"efb33b73-ad8e-46f5-973d-72d0f750e44f","session_time":12.57522988319397,"message":"Session started successfully","session_type":"subprocess","startup_time_ms":6.586551666259766,"total_sessions":1,"run_dir":"loquilex/out/efb33b73-ad8e-46f5-973d-72d0f750e44f"}
{"timestamp":1758527394.0997205,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"efb33b73-ad8e-46f5-973d-72d0f750e44f","session_time":12.613540887832642,"message":"Stopping session"}
{"timestamp":1758527394.1523247,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.666177034378052,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":4.0,"increment":1.0}
{"timestamp":1758527394.1537702,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.66793179512024,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527394.155317,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"efb33b73-ad8e-46f5-973d-72d0f750e44f","session_time":12.66921353340149,"message":"Session stopped successfully","total_sessions":0}
______ TestStreamingIntegration.test_websocket_streaming_events[asyncio] _______
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527394.2388258,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":12.75265908241272,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=fa4db50f-48f7-49c9-92b4-24ce45910ae0
{"timestamp":1758527394.2414694,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"asr_metrics","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":0.0006546974182128906,"message":"ASR metrics initialized","stream_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0"}
{"timestamp":1758527394.2434103,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.757251262664795,"message":"Metric recorded: session_startup_fa4db50f-48f7-49c9-92b4-24ce45910ae0","metric_type":"latency","metric_name":"session_startup_fa4db50f-48f7-49c9-92b4-24ce45910ae0","metric_value":3.2901763916015625}
{"timestamp":1758527394.2443326,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.758154153823853,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":5.0,"increment":1.0}
{"timestamp":1758527394.2454045,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":12.759252309799194,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527394.2464232,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":12.76025104522705,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.2901763916015625,"total_sessions":1,"run_dir":"loquilex/out/fa4db50f-48f7-49c9-92b4-24ce45910ae0"}
{"timestamp":1758527394.357549,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"asr_metrics","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":0.11673927307128906,"message":"ASR event: partial","event_type":"partial","stream_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_duration":0.11662924300253508,"text_length":11,"word_count":2,"seq":1,"segment_id":"test_seg"}
{"timestamp":1758527394.359106,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"asr_metrics","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":0.11829185485839844,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":1.4155439966998529,"segment_id":"test_seg","eou_reason":"punctuation"}
{"timestamp":1758527394.3603747,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"asr_metrics","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":0.11955595016479492,"message":"ASR event: final","event_type":"final","stream_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_duration":0.11936089600203559,"text_length":12,"word_count":2,"eou_reason":"punctuation","segment_duration_ms":1.4155439966998529,"segment_id":"test_seg"}
{"timestamp":1758527394.4738011,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":12.987621545791626,"message":"Stopping session"}
{"timestamp":1758527394.5435636,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.057390451431274,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":5.0,"increment":1.0}
{"timestamp":1758527394.544421,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.058237552642822,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527394.5452461,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"fa4db50f-48f7-49c9-92b4-24ce45910ae0","session_time":13.059076309204102,"message":"Session stopped successfully","total_sessions":0}
________ TestStreamingIntegration.test_websocket_streaming_events[trio] ________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527394.6370683,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":13.150916814804077,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=6d00ea4c-d107-4584-9f57-f6ee12bbc1e6
{"timestamp":1758527394.6396482,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"asr_metrics","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":0.00067138671875,"message":"ASR metrics initialized","stream_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6"}
{"timestamp":1758527394.6414654,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.155295372009277,"message":"Metric recorded: session_startup_6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","metric_type":"latency","metric_name":"session_startup_6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","metric_value":3.1425952911376953}
{"timestamp":1758527394.642408,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.15625,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":6.0,"increment":1.0}
{"timestamp":1758527394.6434014,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.1572265625,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527394.6443534,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":13.15817379951477,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.1425952911376953,"total_sessions":1,"run_dir":"loquilex/out/6d00ea4c-d107-4584-9f57-f6ee12bbc1e6"}
{"timestamp":1758527394.7556415,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"asr_metrics","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":0.11666345596313477,"message":"ASR event: partial","event_type":"partial","stream_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_duration":0.11651119900125195,"text_length":11,"word_count":2,"seq":1,"segment_id":"test_seg"}
{"timestamp":1758527394.7571924,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"asr_metrics","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":0.11820650100708008,"message":"Metric recorded: final_latency","metric_type":"latency","metric_name":"final_latency","metric_value":1.4815809990977868,"segment_id":"test_seg","eou_reason":"punctuation"}
{"timestamp":1758527394.7584748,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"asr_metrics","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":0.11949491500854492,"message":"ASR event: final","event_type":"final","stream_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_duration":0.11916682300216053,"text_length":12,"word_count":2,"eou_reason":"punctuation","segment_duration_ms":1.4815809990977868,"segment_id":"test_seg"}
{"timestamp":1758527394.8719316,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":13.385753154754639,"message":"Stopping session"}
{"timestamp":1758527394.9418716,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.455716133117676,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":6.0,"increment":1.0}
{"timestamp":1758527394.9427285,"iso_timestamp":"2025-09-22T07:49:54Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.456539630889893,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527394.943411,"iso_timestamp":"2025-09-22T07:49:54Z","level":"info","component":"session_manager","session_id":"6d00ea4c-d107-4584-9f57-f6ee12bbc1e6","session_time":13.457227230072021,"message":"Session stopped successfully","total_sessions":0}
_________ TestStreamingConfiguration.test_streaming_config_validation __________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527395.0274463,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_time":13.541301250457764,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.5,"segment_max_sec":8.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=fbc303bb-bae5-4ae0-8863-c62e8ff0f17c
{"timestamp":1758527395.0300035,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_time":0.0006432533264160156,"message":"ASR metrics initialized","stream_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c"}
{"timestamp":1758527395.0320268,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.545862436294556,"message":"Metric recorded: session_startup_fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","metric_type":"latency","metric_name":"session_startup_fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","metric_value":3.255128860473633}{"timestamp":1758527395.0333223,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_time":0.0038995742797851562,"message":"ASR event: partial","event_type":"partial","stream_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_duration":0.003963226001360454,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg2428616c"}

{"timestamp":1758527395.034241,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.548068284988403,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":7.0,"increment":1.0}
{"timestamp":1758527395.0351942,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.549023628234863,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527395.0364513,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_time":13.550282001495361,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.255128860473633,"total_sessions":1,"run_dir":"loquilex/out/fbc303bb-bae5-4ae0-8863-c62e8ff0f17c"}
{"timestamp":1758527395.0571878,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_time":13.571026802062988,"message":"Stopping session"}
{"timestamp":1758527395.2346816,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.748560428619385,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":7.0,"increment":1.0}
{"timestamp":1758527395.2357597,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.749600172042847,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527395.2366323,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"fbc303bb-bae5-4ae0-8863-c62e8ff0f17c","session_time":13.75047254562378,"message":"Session stopped successfully","total_sessions":0}
_____________ TestStreamingConfiguration.test_model_id_validation ______________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527395.31688,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_time":13.830754280090332,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=a6084910-b44a-44ff-95b9-50ef2e97d651
{"timestamp":1758527395.3194828,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_time":0.000640869140625,"message":"ASR metrics initialized","stream_id":"a6084910-b44a-44ff-95b9-50ef2e97d651"}
{"timestamp":1758527395.3216796,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.83551573753357,"message":"Metric recorded: session_startup_a6084910-b44a-44ff-95b9-50ef2e97d651","metric_type":"latency","metric_name":"session_startup_a6084910-b44a-44ff-95b9-50ef2e97d651","metric_value":3.4351348876953125}
{"timestamp":1758527395.32272,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.836547613143921,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":8.0,"increment":1.0}
{"timestamp":1758527395.323652,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":13.837480545043945,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527395.324765,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_time":13.8385910987854,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.4351348876953125,"total_sessions":1,"run_dir":"loquilex/out/a6084910-b44a-44ff-95b9-50ef2e97d651"}
{"timestamp":1758527395.3309307,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_time":0.012017965316772461,"message":"ASR event: partial","event_type":"partial","stream_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_duration":0.012141311999585014,"text_length":11,"word_count":2,"seq":1,"segment_id":"segfd2106af"}
{"timestamp":1758527395.3463018,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_time":13.860125303268433,"message":"Stopping session"}
{"timestamp":1758527395.53233,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.046181678771973,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":8.0,"increment":1.0}
{"timestamp":1758527395.5333066,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.047125101089478,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527395.5339599,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"a6084910-b44a-44ff-95b9-50ef2e97d651","session_time":14.047775268554688,"message":"Session stopped successfully","total_sessions":0}
{"timestamp":1758527395.5582197,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_time":14.07206654548645,"message":"Starting session","config":{"name":"session","asr_model_id":"small.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d
{"timestamp":1758527395.5606835,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_time":0.0006346702575683594,"message":"ASR metrics initialized","stream_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d"}
{"timestamp":1758527395.562815,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_time":0.0027060508728027344,"message":"ASR event: partial","event_type":"partial","stream_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_duration":0.002766703000816051,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg611c4b03"}
{"timestamp":1758527395.5643585,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.078214645385742,"message":"Metric recorded: session_startup_6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","metric_type":"latency","metric_name":"session_startup_6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","metric_value":4.822492599487305}
{"timestamp":1758527395.5653973,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.07925033569336,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":9.0,"increment":1.0}
{"timestamp":1758527395.5662904,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.080115795135498,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527395.5672362,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_time":14.081061124801636,"message":"Session started successfully","session_type":"streaming","startup_time_ms":4.822492599487305,"total_sessions":1,"run_dir":"loquilex/out/6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d"}
{"timestamp":1758527395.5859082,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_time":14.099737644195557,"message":"Stopping session"}
{"timestamp":1758527395.6645155,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.178449869155884,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":9.0,"increment":1.0}
{"timestamp":1758527395.6655352,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.179350137710571,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527395.6661763,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"6b39d00e-e7e5-4b11-a4d3-0da38d4cab3d","session_time":14.179992914199829,"message":"Session stopped successfully","total_sessions":0}
{"timestamp":1758527395.6925902,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_time":14.20644235610962,"message":"Starting session","config":{"name":"session","asr_model_id":"base.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=c9e2daaf-a102-4057-8964-78383c4c8957
{"timestamp":1758527395.6950872,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_time":0.0006496906280517578,"message":"ASR metrics initialized","stream_id":"c9e2daaf-a102-4057-8964-78383c4c8957"}
{"timestamp":1758527395.6976466,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_time":0.003165721893310547,"message":"ASR event: partial","event_type":"partial","stream_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_duration":0.003208251000614837,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg4a22a919"}
{"timestamp":1758527395.6986578,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.212495565414429,"message":"Metric recorded: session_startup_c9e2daaf-a102-4057-8964-78383c4c8957","metric_type":"latency","metric_name":"session_startup_c9e2daaf-a102-4057-8964-78383c4c8957","metric_value":4.8198699951171875}
{"timestamp":1758527395.6996129,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.213462114334106,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":10.0,"increment":1.0}
{"timestamp":1758527395.7006001,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.214445352554321,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527395.701667,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_time":14.215494394302368,"message":"Session started successfully","session_type":"streaming","startup_time_ms":4.8198699951171875,"total_sessions":1,"run_dir":"loquilex/out/c9e2daaf-a102-4057-8964-78383c4c8957"}
{"timestamp":1758527395.7211154,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_time":14.234949111938477,"message":"Stopping session"}
{"timestamp":1758527395.8989658,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.412816047668457,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":10.0,"increment":1.0}
{"timestamp":1758527395.900016,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.413833379745483,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527395.9007382,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"c9e2daaf-a102-4057-8964-78383c4c8957","session_time":14.414557933807373,"message":"Session stopped successfully","total_sessions":0}
{"timestamp":1758527395.9247696,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_time":14.438596725463867,"message":"Starting session","config":{"name":"session","asr_model_id":"medium.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=2af43dab-9418-436a-97bc-6d519079d9ea
{"timestamp":1758527395.9271824,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_time":0.0006492137908935547,"message":"ASR metrics initialized","stream_id":"2af43dab-9418-436a-97bc-6d519079d9ea"}
{"timestamp":1758527395.929123,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.442952156066895,"message":"Metric recorded: session_startup_2af43dab-9418-436a-97bc-6d519079d9ea","metric_type":"latency","metric_name":"session_startup_2af43dab-9418-436a-97bc-6d519079d9ea","metric_value":3.12042236328125}{"timestamp":1758527395.9303906,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"asr_metrics","session_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_time":0.0037975311279296875,"message":"ASR event: partial","event_type":"partial","stream_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_duration":0.0037894159977440722,"text_length":11,"word_count":2,"seq":1,"segment_id":"segc59c630e"}

{"timestamp":1758527395.9313624,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.445188283920288,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":11.0,"increment":1.0}
{"timestamp":1758527395.9322746,"iso_timestamp":"2025-09-22T07:49:55Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.446095943450928,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527395.933346,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_time":14.4471755027771,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.12042236328125,"total_sessions":1,"run_dir":"loquilex/out/2af43dab-9418-436a-97bc-6d519079d9ea"}
{"timestamp":1758527395.9526155,"iso_timestamp":"2025-09-22T07:49:55Z","level":"info","component":"session_manager","session_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_time":14.466442584991455,"message":"Stopping session"}
{"timestamp":1758527396.1319058,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.645756006240845,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":11.0,"increment":1.0}
{"timestamp":1758527396.1329532,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.646769285202026,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527396.1336772,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"2af43dab-9418-436a-97bc-6d519079d9ea","session_time":14.647495746612549,"message":"Session stopped successfully","total_sessions":0}
_______________ TestStreamingConfiguration.test_device_selection _______________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527396.2072816,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_time":14.721118450164795,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=ec71a5c2-9015-4eba-86f5-b1e1d0144a79
{"timestamp":1758527396.209961,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_time":0.0006899833679199219,"message":"ASR metrics initialized","stream_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79"}
{"timestamp":1758527396.212051,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.725885391235352,"message":"Metric recorded: session_startup_ec71a5c2-9015-4eba-86f5-b1e1d0144a79","metric_type":"latency","metric_name":"session_startup_ec71a5c2-9015-4eba-86f5-b1e1d0144a79","metric_value":3.459930419921875}
{"timestamp":1758527396.2130525,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.72688102722168,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":12.0,"increment":1.0}
{"timestamp":1758527396.2140815,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.7279212474823,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527396.21514,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_time":14.728968620300293,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.459930419921875,"total_sessions":1,"run_dir":"loquilex/out/ec71a5c2-9015-4eba-86f5-b1e1d0144a79"}
{"timestamp":1758527396.220734,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_time":0.011391878128051758,"message":"ASR event: partial","event_type":"partial","stream_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_duration":0.011525804999109823,"text_length":11,"word_count":2,"seq":1,"segment_id":"segc87456e0"}
{"timestamp":1758527396.2369063,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_time":14.75073528289795,"message":"Stopping session"}
{"timestamp":1758527396.4239306,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.937777042388916,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":12.0,"increment":1.0}
{"timestamp":1758527396.4249141,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.938730716705322,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527396.4255917,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"ec71a5c2-9015-4eba-86f5-b1e1d0144a79","session_time":14.939408302307129,"message":"Session stopped successfully","total_sessions":0}
{"timestamp":1758527396.4497333,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_time":14.96356987953186,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"auto","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f
{"timestamp":1758527396.4521163,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_time":0.0005939006805419922,"message":"ASR metrics initialized","stream_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f"}
{"timestamp":1758527396.45414,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.967978239059448,"message":"Metric recorded: session_startup_0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","metric_type":"latency","metric_name":"session_startup_0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","metric_value":3.139972686767578}
{"timestamp":1758527396.455139,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.968965530395508,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":13.0,"increment":1.0}
{"timestamp":1758527396.4560747,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":14.96989917755127,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527396.4571865,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_time":14.971014499664307,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.139972686767578,"total_sessions":1,"run_dir":"loquilex/out/0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f"}
{"timestamp":1758527396.4631124,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_time":0.011519432067871094,"message":"ASR event: partial","event_type":"partial","stream_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_duration":0.011568482997972751,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg6a0afc1a"}
{"timestamp":1758527396.4783986,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_time":14.99221658706665,"message":"Stopping session"}
{"timestamp":1758527396.6646469,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.178477048873901,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":13.0,"increment":1.0}
{"timestamp":1758527396.6654954,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.179310083389282,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527396.6661692,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"0ea82aab-cbdb-4305-ad8e-1d2203ec4b4f","session_time":15.17998743057251,"message":"Session stopped successfully","total_sessions":0}
___________ TestSnapshotStatus.test_streaming_session_status_running ___________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527396.7349193,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_time":15.24877142906189,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=36c6189c-8b93-412e-af68-e33002e3156a
{"timestamp":1758527396.7374198,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_time":0.0006742477416992188,"message":"ASR metrics initialized","stream_id":"36c6189c-8b93-412e-af68-e33002e3156a"}
{"timestamp":1758527396.7401216,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_time":0.0033121109008789062,"message":"ASR event: partial","event_type":"partial","stream_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_duration":0.0033019799993780907,"text_length":11,"word_count":2,"seq":1,"segment_id":"segf3e6d8d8"}{"timestamp":1758527396.741339,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.255182266235352,"message":"Metric recorded: session_startup_36c6189c-8b93-412e-af68-e33002e3156a","metric_type":"latency","metric_name":"session_startup_36c6189c-8b93-412e-af68-e33002e3156a","metric_value":5.093097686767578}
{"timestamp":1758527396.742353,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.256179332733154,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":14.0,"increment":1.0}
{"timestamp":1758527396.7433286,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.257158041000366,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527396.7443984,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_time":15.258241415023804,"message":"Session started successfully","session_type":"streaming","startup_time_ms":5.093097686767578,"total_sessions":1,"run_dir":"loquilex/out/36c6189c-8b93-412e-af68-e33002e3156a"}

{"timestamp":1758527396.7864778,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_time":15.300302028656006,"message":"Stopping session"}
{"timestamp":1758527396.858847,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.372707843780518,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":14.0,"increment":1.0}
{"timestamp":1758527396.859747,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.373563051223755,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527396.860422,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"36c6189c-8b93-412e-af68-e33002e3156a","session_time":15.374236345291138,"message":"Session stopped successfully","total_sessions":0}
___________ TestSnapshotStatus.test_streaming_session_status_stopped ___________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527396.927499,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_time":15.44133448600769,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=85f5187f-4ebf-4f38-8642-384579012bb5
{"timestamp":1758527396.9299588,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_time":0.0005860328674316406,"message":"ASR metrics initialized","stream_id":"85f5187f-4ebf-4f38-8642-384579012bb5"}
{"timestamp":1758527396.9319828,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.44591236114502,"message":"Metric recorded: session_startup_85f5187f-4ebf-4f38-8642-384579012bb5","metric_type":"latency","metric_name":"session_startup_85f5187f-4ebf-4f38-8642-384579012bb5","metric_value":3.1402111053466797}
{"timestamp":1758527396.9333277,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.447169780731201,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":15.0,"increment":1.0}
{"timestamp":1758527396.934266,"iso_timestamp":"2025-09-22T07:49:56Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.448091983795166,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527396.935303,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_time":15.449126958847046,"message":"Session started successfully","session_type":"streaming","startup_time_ms":3.1402111053466797,"total_sessions":1,"run_dir":"loquilex/out/85f5187f-4ebf-4f38-8642-384579012bb5"}
{"timestamp":1758527396.9407537,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"asr_metrics","session_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_time":0.011323213577270508,"message":"ASR event: partial","event_type":"partial","stream_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_duration":0.011396827998396475,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg4bcf1a2c"}
{"timestamp":1758527396.9576838,"iso_timestamp":"2025-09-22T07:49:56Z","level":"info","component":"session_manager","session_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_time":15.47156572341919,"message":"Stopping session"}
{"timestamp":1758527397.1429617,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.65688180923462,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":15.0,"increment":1.0}
{"timestamp":1758527397.1443286,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.65816354751587,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}

## Steps Taken ‚Äî PR #103 (copilot/fix-103)
Mon Sep 22 08:26:40 UTC 2025

### Summary
- Selected: PR branch `copilot/fix-103`.
- Merge: Clean merge of `origin/main` into feature (combine-first) with ephemeral union rules in `.git/MERGE_ATTRS` for docs/yml/env.
- Formatting: Ran Black to fix CI formatting on 4 files:
  - `loquilex/hardware/__init__.py`
  - `loquilex/hardware/detection.py`
  - `tests/test_api_hardware.py`
  - `tests/test_hardware_detection.py`
- CI: Docker CI parity passed end-to-end.
  - Ruff OK, Black OK, MyPy OK
  - Pytest: 238 passed, 4 skipped (unit/integration); E2E: 10 passed
- Commit/Push: Recorded merge success commit and pushed branch.
  - "style: format hardware modules and tests (Black)"
  - "merge: sync copilot/fix-103 with origin/main (combine-first); Docker CI green"
- PR Update: PR body update pending (gh lookup for PR number did not return in this session).

### Follow-up: MyPy fix (psutil stubs)
Mon Sep 22 08:41:12 UTC 2025
- Symptom: CI mypy flagged missing stubs for `psutil` after hardware snapshot changes.
- Fix: Added `types-psutil` to `requirements-ci.txt` and `requirements-dev.txt`.
- Code tweak: Annotated optional `psutil` import as `Any` in `loquilex/hardware/detection.py` to avoid Module‚ÜíNone assignment error in minimal profiles.
- Result: `make typecheck` ‚Üí Success: no issues found.

## Steps Taken ‚Äî PR #123 (copilot/fix-107)
Mon Sep 22 09:10:31 UTC 2025

### Summary
- Selected: PR #123 `copilot/fix-107` ‚Äî Model indexing + defaults.
- Merge: Clean merge of `origin/main` into feature using combine-first; ephemeral `.git/MERGE_ATTRS` with union for docs/yml/env.
- CI: Docker CI parity passed (ruff/black/mypy/pytest). Unit+integration count expanded (model defaults/indexing now covered).
- Commit/Push: Added empty commit noting merge+CI; pushed branch.
- PR Update: Edited PR body with merge+CI details and conflict strategy.

### Notes
- First CI attempt interrupted (exit 130). Reran via task and terminal; all checks green on retry.

{"timestamp":1758527397.1451836,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"85f5187f-4ebf-4f38-8642-384579012bb5","session_time":15.659018754959106,"message":"Session stopped successfully","total_sessions":0}
____________ TestErrorHygiene.test_metrics_error_no_exception_leak _____________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527397.2829056,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"78b666d8-c493-4026-b3b0-7f23dd87de39","session_time":15.796759128570557,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":false}}
{"timestamp":1758527397.292432,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.806276559829712,"message":"Metric recorded: session_startup_78b666d8-c493-4026-b3b0-7f23dd87de39","metric_type":"latency","metric_name":"session_startup_78b666d8-c493-4026-b3b0-7f23dd87de39","metric_value":8.010387420654297}
{"timestamp":1758527397.2936206,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.80746340751648,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":16.0,"increment":1.0}
{"timestamp":1758527397.29456,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.80839729309082,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527397.2957716,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"78b666d8-c493-4026-b3b0-7f23dd87de39","session_time":15.809709310531616,"message":"Session started successfully","session_type":"subprocess","startup_time_ms":8.010387420654297,"total_sessions":1,"run_dir":"loquilex/out/78b666d8-c493-4026-b3b0-7f23dd87de39"}
{"timestamp":1758527397.3205633,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"78b666d8-c493-4026-b3b0-7f23dd87de39","session_time":15.834441661834717,"message":"Stopping session"}
{"timestamp":1758527397.373661,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.887563228607178,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":16.0,"increment":1.0}
{"timestamp":1758527397.3748112,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.888650178909302,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527397.3756685,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"78b666d8-c493-4026-b3b0-7f23dd87de39","session_time":15.889495849609375,"message":"Session stopped successfully","total_sessions":0}
____________ TestErrorHygiene.test_snapshot_error_no_exception_leak ____________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527397.4788544,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_time":15.992807865142822,"message":"Starting session","config":{"name":"session","asr_model_id":"tiny.en","mt_enabled":false,"dest_lang":"zho_Hans","device":"cpu","vad":true,"beams":1,"pause_flush_sec":0.7,"segment_max_sec":7.0,"partial_word_cap":10,"save_audio":"off","mt_model_id":null,"streaming_mode":true}}
[FakeStreamingASR] Initialized: stream_id=821d72f7-1bf3-4dfc-911e-442e895901c1
{"timestamp":1758527397.48267,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"asr_metrics","session_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_time":0.0008692741394042969,"message":"ASR metrics initialized","stream_id":"821d72f7-1bf3-4dfc-911e-442e895901c1"}
{"timestamp":1758527397.4853196,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":15.999178886413574,"message":"Metric recorded: session_startup_821d72f7-1bf3-4dfc-911e-442e895901c1","metric_type":"latency","metric_name":"session_startup_821d72f7-1bf3-4dfc-911e-442e895901c1","metric_value":4.470348358154297}{"timestamp":1758527397.4870903,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"asr_metrics","session_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_time":0.005166292190551758,"message":"ASR event: partial","event_type":"partial","stream_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_duration":0.005378622001444455,"text_length":11,"word_count":2,"seq":1,"segment_id":"seg0841e4c2"}

{"timestamp":1758527397.488146,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":16.002001762390137,"message":"Counter incremented: sessions_started","metric_type":"counter","metric_name":"sessions_started","counter_value":17.0,"increment":1.0}
{"timestamp":1758527397.489325,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":16.003157138824463,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":1}
{"timestamp":1758527397.490475,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_time":16.00433611869812,"message":"Session started successfully","session_type":"streaming","startup_time_ms":4.470348358154297,"total_sessions":1,"run_dir":"loquilex/out/821d72f7-1bf3-4dfc-911e-442e895901c1"}
{"timestamp":1758527397.533362,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_time":16.047186136245728,"message":"Stopping session"}
{"timestamp":1758527397.5882618,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":16.102107524871826,"message":"Counter incremented: sessions_stopped","metric_type":"counter","metric_name":"sessions_stopped","counter_value":17.0,"increment":1.0}
{"timestamp":1758527397.5891504,"iso_timestamp":"2025-09-22T07:49:57Z","level":"debug","component":"session_manager","session_id":"supervisor","session_time":16.102969646453857,"message":"Gauge updated: active_sessions","metric_type":"gauge","metric_name":"active_sessions","gauge_value":0}
{"timestamp":1758527397.5898106,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"session_manager","session_id":"821d72f7-1bf3-4dfc-911e-442e895901c1","session_time":16.103626012802124,"message":"Session stopped successfully","total_sessions":0}
_______________ TestStructuredLogger.test_create_logger_factory ________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527397.836724,"iso_timestamp":"2025-09-22T07:49:57Z","level":"info","component":"factory_test","session_id":"factory_session","session_time":0.0015211105346679688,"message":"Factory test message"}
_______________________ test_legacy_message_type_mapping _______________________
----------------------------- Captured stdout call -----------------------------
{"timestamp":1758527399.9471543,"iso_timestamp":"2025-09-22T07:49:59Z","level":"info","component":"session_manager","session_id":"supervisor","session_time":0.0003933906555175781,"message":"SessionManager initialized","max_cuda_sessions":1,"websocket_config":{"heartbeat_interval_ms":10000,"heartbeat_timeout_ms":30000,"max_in_flight":64,"max_msg_bytes":131072}}
___________ TestWSProtocolManager.test_flow_control_prevents_sending ___________
------------------------------ Captured log call -------------------------------
WARNING  loquilex.api.ws_protocol:ws_protocol.py:447 Flow control prevents sending MessageType.ASR_PARTIAL
_________________ TestWSProtocolManager.test_heartbeat_sending _________________
------------------------------ Captured log call -------------------------------
ERROR    loquilex.api.ws_protocol:ws_protocol.py:670 System heartbeat loop error:
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/unittest/mock.py", line 2294, in _execute_mock_call
    result = next(effect)
             ^^^^^^^^^^^^
StopIteration

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/loquilex/api/ws_protocol.py", line 633, in _system_heartbeat_loop
    await asyncio.sleep(self.hb_config.interval_ms / 1000.0)
  File "/usr/local/lib/python3.12/unittest/mock.py", line 2298, in _execute_mock_call
    raise StopAsyncIteration
StopAsyncIteration
_____________ TestWSProtocolManager.test_invalid_message_handling ______________
------------------------------ Captured log call -------------------------------
ERROR    loquilex.api.ws_protocol:ws_protocol.py:219 Error handling WebSocket message: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/app/loquilex/api/ws_protocol.py", line 201, in handle_message
    data = json.loads(message)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/json/decoder.py", line 338, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/json/decoder.py", line 356, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
___________ TestWSProtocolManager.test_unknown_message_type_handling ___________
------------------------------ Captured log call -------------------------------
ERROR    loquilex.api.ws_protocol:ws_protocol.py:219 Error handling WebSocket message: 1 validation error for WSEnvelope
t
  Input should be 'client.hello', 'server.welcome', 'server.error', 'client.hb', 'server.hb', 'client.ack', 'server.ack', 'client.flow', 'asr.partial', 'asr.final', 'mt.partial', 'mt.final', 'status', 'session.resume', 'session.snapshot', 'session.new', 'session.ack', 'system.heartbeat', 'queue.drop' or 'system.metrics' [type=enum, input_value='unknown.type', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
Traceback (most recent call last):
  File "/app/loquilex/api/ws_protocol.py", line 202, in handle_message
    envelope = WSEnvelope.model_validate(data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/venv/lib/python3.12/site-packages/pydantic/main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for WSEnvelope
t
  Input should be 'client.hello', 'server.welcome', 'server.error', 'client.hb', 'server.hb', 'client.ack', 'server.ack', 'client.flow', 'asr.partial', 'asr.final', 'mt.partial', 'mt.final', 'status', 'session.resume', 'session.snapshot', 'session.new', 'session.ack', 'system.heartbeat', 'queue.drop' or 'system.metrics' [type=enum, input_value='unknown.type', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
____________ TestWSProtocolManager.test_connection_failure_handling ____________
------------------------------ Captured log call -------------------------------
WARNING  loquilex.api.ws_protocol:ws_protocol.py:501 Failed to send to connection: Connection failed
_____ TestWSProtocolManager.test_session_cleanup_on_all_connections_failed _____
------------------------------ Captured log call -------------------------------
WARNING  loquilex.api.ws_protocol:ws_protocol.py:501 Failed to send to connection: Connection failed
_______________ TestWSProtocolManager.test_ack_spoof_protection ________________
------------------------------ Captured log call -------------------------------
WARNING  loquilex.api.ws_protocol:ws_protocol.py:399 Client ack beyond latest seq: 99 > 2
=========================== short test summary info ============================
PASSED tests/test_aggregator.py::test_aggregator_partial_debounce
PASSED tests/test_aggregator.py::test_aggregator_force_finalize
PASSED tests/test_api_minimal_http.py::test_create_and_stop_minimal_session_http
PASSED tests/test_api_minimal_session.py::test_minimal_session_lifecycle
PASSED tests/test_api_modules_import.py::test_import_api_modules_for_coverage
PASSED tests/test_asr_metrics.py::TestLatencyMetrics::test_empty_metrics
PASSED tests/test_asr_metrics.py::TestLatencyMetrics::test_single_measurement
PASSED tests/test_asr_metrics.py::TestLatencyMetrics::test_multiple_measurements
PASSED tests/test_asr_metrics.py::TestLatencyMetrics::test_bounded_recent_values
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_basic_metrics
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_asr_metrics_with_structured_logging
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_initialization
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_partial_event_tracking
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_final_event_tracking
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_eou_reason_counting
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_summary_generation
PASSED tests/test_asr_metrics.py::TestASRMetrics::test_performance_targets
PASSED tests/test_asr_metrics.py::TestMetricsIntegration::test_aggregator_with_metrics
PASSED tests/test_asr_metrics.py::TestMetricsIntegration::test_aggregator_without_metrics
PASSED tests/test_asr_metrics.py::TestMetricsIntegration::test_metrics_in_stats
PASSED tests/test_bounded_queue.py::TestDropMetrics::test_initialization
PASSED tests/test_bounded_queue.py::TestDropMetrics::test_record_drop
PASSED tests/test_bounded_queue.py::TestDropMetrics::test_read_and_reset_recent
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_initialization
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_invalid_maxsize
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_put_get_basic
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_capacity_and_drop_oldest
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_peek
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_clear
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_drain
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_telemetry
PASSED tests/test_bounded_queue.py::TestBoundedQueue::test_thread_safety_structure
PASSED tests/test_bounded_queue.py::TestReplayBuffer::test_initialization
PASSED tests/test_bounded_queue.py::TestReplayBuffer::test_add_message_with_seq
PASSED tests/test_bounded_queue.py::TestReplayBuffer::test_get_messages_after
PASSED tests/test_bounded_queue.py::TestReplayBuffer::test_ttl_cleanup
PASSED tests/test_bounded_queue.py::TestReplayBuffer::test_ttl_disabled
PASSED tests/test_cli_integration_offline.py::test_wav_to_vtt_offline_with_fake_asr
PASSED tests/test_cli_integration_offline.py::test_vtt_to_zh_offline_with_fake_mt
PASSED tests/test_cli_integration_offline.py::test_output_boundary_respected
PASSED tests/test_cli_smoke.py::test_cli_runs_with_fake_capture_and_translator
PASSED tests/test_compat_versions.py::test_starlette_httpx_compat
PASSED tests/test_config_env.py::test_env_overrides
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_seconds
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_milliseconds
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_minutes
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_with_hours
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_plain_number
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_invalid_value
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_time_parsing_no_env_var
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_ws_protocol_config_with_time_suffixes
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_ws_protocol_config_defaults
PASSED tests/test_config_parsing.py::TestConfigurationParsing::test_complex_time_formats
PASSED tests/test_e2e_resume_flow.py::TestE2EResumeFlow::test_resume_flow_no_duplicate_finals
PASSED tests/test_e2e_resume_flow.py::TestE2EResumeFlow::test_ordering_guarantees_after_resume
PASSED tests/test_e2e_resume_flow.py::TestE2EResumeFlow::test_resume_with_expired_window
PASSED tests/test_live_outputs.py::test_partial_and_final_files
PASSED tests/test_live_outputs.py::test_append_vtt_and_srt
PASSED tests/test_mt_integration.py::test_mt_integration_disabled
PASSED tests/test_mt_integration.py::test_mt_integration_translate_and_emit
PASSED tests/test_mt_integration.py::test_mt_integration_error_handling
PASSED tests/test_mt_integration.py::test_mt_integration_status
PASSED tests/test_mt_registry.py::test_registry_operations
PASSED tests/test_mt_registry.py::test_registry_unknown_provider
PASSED tests/test_mt_registry.py::test_mt_module_imports_without_heavy_deps
PASSED tests/test_offline_env.py::test_offline_env_vars_set[HF_HUB_OFFLINE]
PASSED tests/test_offline_env.py::test_offline_env_vars_set[TRANSFORMERS_OFFLINE]
PASSED tests/test_offline_env.py::test_offline_env_vars_set[HF_HUB_DISABLE_TELEMETRY]
PASSED tests/test_offline_env.py::test_offline_env_vars_set[LX_OFFLINE]
PASSED tests/test_offline_isolation.py::test_offline_network_guard_blocks_external
PASSED tests/test_offline_isolation.py::test_offline_network_guard_allows_localhost
PASSED tests/test_offline_isolation.py::test_offline_env_vars_set
PASSED tests/test_resilient_comms.py::TestResilientComms::test_session_resume_within_window
PASSED tests/test_resilient_comms.py::TestResilientComms::test_session_resume_expired
PASSED tests/test_resilient_comms.py::TestResilientComms::test_session_resume_wrong_session_id
PASSED tests/test_resilient_comms.py::TestResilientComms::test_session_resume_wrong_epoch
PASSED tests/test_resilient_comms.py::TestResilientComms::test_telemetry_summary
PASSED tests/test_resilient_comms.py::TestResilientComms::test_queue_drop_notification
PASSED tests/test_resilient_comms.py::TestResilientComms::test_environment_configuration
PASSED tests/test_resource_management.py::TestStreamingSessionResourceManagement::test_context_manager_cleanup
PASSED tests/test_resource_management.py::TestStreamingSessionResourceManagement::test_destructor_cleanup
PASSED tests/test_resource_management.py::TestSessionResourceManagement::test_context_manager_cleanup
PASSED tests/test_resource_management.py::TestSessionResourceManagement::test_destructor_handles_subprocess_cleanup
PASSED tests/test_resource_management.py::TestSessionManagerResourceManagement::test_shutdown_cleans_all_resources
PASSED tests/test_resource_management.py::TestSessionManagerResourceManagement::test_destructor_sets_stop_flag
PASSED tests/test_resource_management.py::TestBoundedQueueResourceManagement::test_cleanup_method_clears_resources
PASSED tests/test_resource_management.py::TestBoundedQueueResourceManagement::test_destructor_clears_queue
PASSED tests/test_resource_management.py::TestRollingTextFileResourceManagement::test_context_manager_support
PASSED tests/test_resource_management.py::TestResourceLeakDetection::test_memory_usage_bounded
PASSED tests/test_resource_management.py::TestResourceLeakDetection::test_thread_cleanup_after_operations
PASSED tests/test_resource_management.py::TestWSProtocolManagerResourceCleanup::test_context_manager_cleanup
PASSED tests/test_resource_management.py::TestWSProtocolManagerResourceCleanup::test_close_method_cleanup
PASSED tests/test_resource_management.py::TestAbruptShutdownScenarios::test_session_cleanup_during_exception
PASSED tests/test_resource_management.py::TestAbruptShutdownScenarios::test_manager_cleanup_with_active_sessions
PASSED tests/test_safe_broadcast.py::test_safe_broadcast_no_loop_does_not_raise
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_storage_initialization
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_storage_with_env_config
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_add_session_commit
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_get_session_snapshot
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_get_session_storage_stats
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_with_sequence_tracking
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_storage_capping
PASSED tests/test_session_state_integration.py::TestSessionStateIntegration::test_session_state_without_storage
PASSED tests/test_session_storage.py::TestStorageConfig::test_default_values
PASSED tests/test_session_storage.py::TestStorageConfig::test_validation_success
PASSED tests/test_session_storage.py::TestStorageConfig::test_validation_negative_commits
PASSED tests/test_session_storage.py::TestStorageConfig::test_validation_negative_size
PASSED tests/test_session_storage.py::TestStorageConfig::test_validation_negative_age
PASSED tests/test_session_storage.py::TestSessionCommit::test_default_values
PASSED tests/test_session_storage.py::TestSessionCommit::test_custom_values
PASSED tests/test_session_storage.py::TestSessionCommit::test_size_calculation
PASSED tests/test_session_storage.py::TestSessionStorage::test_initialization
PASSED tests/test_session_storage.py::TestSessionStorage::test_initialization_with_config
PASSED tests/test_session_storage.py::TestSessionStorage::test_add_commit_basic
PASSED tests/test_session_storage.py::TestSessionStorage::test_add_multiple_commits
PASSED tests/test_session_storage.py::TestSessionStorage::test_get_commits_all
PASSED tests/test_session_storage.py::TestSessionStorage::test_get_commits_with_limit
PASSED tests/test_session_storage.py::TestSessionStorage::test_get_commits_by_type
PASSED tests/test_session_storage.py::TestSessionStorage::test_get_commits_since_timestamp
PASSED tests/test_session_storage.py::TestSessionStorage::test_count_based_capping
PASSED tests/test_session_storage.py::TestSessionStorage::test_time_based_capping
PASSED tests/test_session_storage.py::TestSessionStorage::test_size_based_capping
PASSED tests/test_session_storage.py::TestSessionStorage::test_get_snapshot
PASSED tests/test_session_storage.py::TestSessionStorage::test_get_snapshot_with_limit
PASSED tests/test_session_storage.py::TestSessionStorage::test_clear_storage
PASSED tests/test_session_storage.py::TestSessionStorage::test_thread_safety
PASSED tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_snapshot_with_finalized_transcript
PASSED tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_resume_metrics_tracking
PASSED tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_resume_miss_tracking
PASSED tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_monotonic_timing_in_envelopes
PASSED tests/test_snapshot_rehydrate.py::TestSnapshotRehydrate::test_final_seq_range_in_snapshot
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_partial_event_processing
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_final_event_processing
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_duplicate_final_prevention
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_partials_after_final_ignored
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_partial_backpressure
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_snapshot_generation
PASSED tests/test_streaming_asr.py::TestPartialFinalAggregator::test_stats_tracking
PASSED tests/test_streaming_asr.py::TestFakeStreamingASR::test_deterministic_behavior
PASSED tests/test_streaming_asr.py::TestFakeStreamingASR::test_snapshot_functionality
PASSED tests/test_streaming_asr.py::TestFakeStreamingASR::test_force_finalize
PASSED tests/test_streaming_asr.py::TestIntegration::test_streaming_asr_with_aggregator
PASSED tests/test_streaming_asr.py::TestAsyncBridge::test_async_bridge_with_event_loop
PASSED tests/test_streaming_asr.py::TestAsyncBridge::test_async_bridge_no_event_loop
PASSED tests/test_streaming_integration.py::TestStreamingIntegration::test_create_streaming_session
PASSED tests/test_streaming_integration.py::TestStreamingIntegration::test_asr_snapshot_endpoint
PASSED tests/test_streaming_integration.py::TestStreamingIntegration::test_regular_session_no_asr_snapshot
PASSED tests/test_streaming_integration.py::TestStreamingIntegration::test_websocket_streaming_events[asyncio]
PASSED tests/test_streaming_integration.py::TestStreamingIntegration::test_websocket_streaming_events[trio]
PASSED tests/test_streaming_integration.py::TestStreamingConfiguration::test_streaming_config_validation
PASSED tests/test_streaming_integration.py::TestStreamingConfiguration::test_model_id_validation
PASSED tests/test_streaming_integration.py::TestStreamingConfiguration::test_device_selection
PASSED tests/test_streaming_integration.py::TestSnapshotStatus::test_streaming_session_status_running
PASSED tests/test_streaming_integration.py::TestSnapshotStatus::test_streaming_session_status_stopped
PASSED tests/test_streaming_integration.py::TestErrorHygiene::test_metrics_error_no_exception_leak
PASSED tests/test_streaming_integration.py::TestErrorHygiene::test_snapshot_error_no_exception_leak
PASSED tests/test_structured_logging.py::TestDataRedactor::test_redact_file_paths
PASSED tests/test_structured_logging.py::TestDataRedactor::test_redact_sensitive_fields
PASSED tests/test_structured_logging.py::TestDataRedactor::test_nested_redaction
PASSED tests/test_structured_logging.py::TestStructuredLogger::test_basic_logging
PASSED tests/test_structured_logging.py::TestStructuredLogger::test_data_redaction
PASSED tests/test_structured_logging.py::TestStructuredLogger::test_create_logger_factory
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_latency_recording
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_throughput_recording
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_counters_and_gauges
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_timer_functionality
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_timer_error_handling
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_threshold_monitoring
PASSED tests/test_structured_logging.py::TestPerformanceMetrics::test_metrics_reset
PASSED tests/test_structured_logging.py::TestLogRetention::test_log_rotation_by_size
PASSED tests/test_structured_logging.py::TestLogRetention::test_log_rotation_keeps_max_files
PASSED tests/test_structured_logging.py::TestLogRetention::test_ci_logger_defaults
PASSED tests/test_structured_logging.py::TestLogRetention::test_cleanup_old_logs
PASSED tests/test_structured_logging.py::TestLogRetention::test_log_retention_env_vars
PASSED tests/test_text_io.py::test_rewrite_keeps_single_last_line
PASSED tests/test_text_io.py::test_append_enforces_max_lines
PASSED tests/test_text_io.py::test_utf8_and_trailing_newline
PASSED tests/test_text_io_concurrency.py::test_rolling_text_concurrent_appends_and_rewrites
PASSED tests/test_timed_outputs.py::test_vtt_srt_append_order
PASSED tests/test_units_extra.py::test_timestamp_formatting_helpers
PASSED tests/test_units_extra.py::test_dtype_kwargs_version_switch
PASSED tests/test_units_extra.py::test_pick_device_cpu
PASSED tests/test_units_extra.py::test_post_processing
PASSED tests/test_vtt_and_mt.py::test_vtt_monotonic
PASSED tests/test_vtt_and_mt.py::test_translator_bos_handling
PASSED tests/test_ws_integration.py::test_legacy_message_type_mapping
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_context_manager_cleanup
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_destructor_cancels_tasks
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_initialization
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_custom_configuration
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_add_connection_sends_welcome
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_remove_connection
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_client_hello_handling
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_client_ack_handling
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_domain_event_sending
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_flow_control_prevents_sending
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_resume_request_handling
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_resume_expired_error
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_heartbeat_sending
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_invalid_message_handling
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_unknown_message_type_handling
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_connection_failure_handling
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_session_cleanup_on_all_connections_failed
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_graceful_close
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_ack_spoof_protection
PASSED tests/test_ws_protocol.py::TestWSProtocolManager::test_resume_with_gaps
PASSED tests/test_ws_types.py::TestWSEnvelope::test_minimal_envelope
PASSED tests/test_ws_types.py::TestWSEnvelope::test_full_envelope
PASSED tests/test_ws_types.py::TestWSEnvelope::test_auto_message_id_generation
PASSED tests/test_ws_types.py::TestWSEnvelope::test_no_auto_id_without_sid
PASSED tests/test_ws_types.py::TestWSEnvelope::test_json_serialization
PASSED tests/test_ws_types.py::TestDomainEventData::test_asr_partial_data
PASSED tests/test_ws_types.py::TestDomainEventData::test_asr_final_data
PASSED tests/test_ws_types.py::TestDomainEventData::test_mt_final_data
PASSED tests/test_ws_types.py::TestDomainEventData::test_status_data
PASSED tests/test_ws_types.py::TestControlMessages::test_client_hello
PASSED tests/test_ws_types.py::TestControlMessages::test_client_hello_with_resume
PASSED tests/test_ws_types.py::TestControlMessages::test_server_welcome
PASSED tests/test_ws_types.py::TestSessionState::test_session_initialization
PASSED tests/test_ws_types.py::TestSessionState::test_sequence_generation
PASSED tests/test_ws_types.py::TestSessionState::test_monotonic_time_calculation
PASSED tests/test_ws_types.py::TestSessionState::test_flow_control_limits
PASSED tests/test_ws_types.py::TestSessionState::test_replay_buffer_management
PASSED tests/test_ws_types.py::TestSessionState::test_replay_message_retrieval
PASSED tests/test_ws_types.py::TestSessionState::test_cumulative_ack_processing
PASSED tests/test_ws_types.py::TestSessionState::test_per_message_ack_processing
SKIPPED [1] ../home/guff/LoquiLex/tests/test_mt_integration.py:25: Skip MT integration tests in offline mode
SKIPPED [1] ../home/guff/LoquiLex/tests/test_mt_registry.py:82: Skip MT provider tests in offline mode
SKIPPED [1] ../home/guff/LoquiLex/tests/test_resilient_comms.py:169: System heartbeat causes infinite loop in tests
SKIPPED [1] ../home/guff/LoquiLex/tests/test_resilient_comms.py:215: Need to fix ReplayBuffer TTL setup
================ 226 passed, 4 skipped, 10 deselected in 21.08s ================
=== Pytest (e2e) ===
..........                                                               [100%]
10 passed, 230 deselected in 2.76s
=== DONE: CI-parity run completed successfully ===
`

Mon Sep 22 07:50:06 UTC 2025

## Conflict Resolution Report

- Result: No conflicts (merge reported up-to-date).
- Strategy: combine-first with ephemeral union attrs.
- Attrs cleanup: .git/MERGE_ATTRS removed

## Evidence & Verification

### Tool Versions


### Docker CI Path
- Used Make targets: docker-ci-build, docker-ci-run
- Image tag: loquilex-ci

## Final Results

- Status: READY ‚Äî Docker CI parity succeeded (unit+e2e).
- Push: No changes to push (branch up-to-date).
- PR Update: Skipped gh PR edit due to API rate limit.

## Files Changed

- None (only gitignored deliverables updated).


### 2025-09-22T03:08-05:00 ‚Äî Next PR runner (merge + CI)
**Mode:** Workspace-Only
**Network:** Offline (no model downloads)
**Secrets/CI:** Unchanged

- Configured git helpers: `rerere.enabled=true`, `rerere.autoUpdate=true`, `merge.conflictStyle=zdiff3`.
- Selected PR: #114 `copilot/fix-95` (oldest by updatedAt) via `gh pr list`.
- Prepared branch: `git fetch --all --prune && git checkout copilot/fix-95` (clean index).
- Ephemeral attributes: wrote `.git/MERGE_ATTRS` with union rules for docs/ignores/env/yml.
- Merge: `git -c core.attributesFile=.git/MERGE_ATTRS merge origin/main` ‚Üí completed by `ort` without conflicts.

Conflict Resolution Report
- combine: docs/ignores/env/yml via union attributes (ephemeral).
- ours: default for code/logic changes.
- theirs: not needed; no workflow/meta conflicts.
- note: merge completed automatically; no manual edits required.

Docker CI parity
- Ran: `make docker-ci-test` (build + run).
- Build: succeeded; cached layers used; exit 0.
- Tests: Ruff/Black/mypy clean; unit/integration passed; e2e subset passed; overall success.

Finalize
- Committed note: `merge: sync with origin/main (combine-first); pass Docker CI`.
- Pushed: `git push origin HEAD`.
- PR updated with summary and CI results via `gh pr edit 114`.
